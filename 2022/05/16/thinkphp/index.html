<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="PHP">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Think PHP5.1 | 执笔丨梨花落</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.2"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">执笔丨梨花落</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">执笔丨梨花落</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/weihan-wu" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/weihan-wu" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Think PHP5.1</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                                <span class="chip bg-color">学习笔记</span>
                            </a>
                        
                            <a href="/tags/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">
                                <span class="chip bg-color">框架学习</span>
                            </a>
                        
                            <a href="/tags/PHP/">
                                <span class="chip bg-color">PHP</span>
                            </a>
                        
                            <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">
                                <span class="chip bg-color">后端开发</span>
                            </a>
                        
                            <a href="/tags/Think-PHP/">
                                <span class="chip bg-color">Think PHP</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/PHP/" class="post-category">
                                PHP
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-05-16
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-16
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    27.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    121 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="ThinkPHP"><a href="#ThinkPHP" class="headerlink" title="ThinkPHP"></a>ThinkPHP</h1><p>TP5.1开发者手册：<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353955">https://www.kancloud.cn/manual/thinkphp5_1/353955</a></p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>ThinkPHP是一个免费开源的，快速、简单的面向对象的轻量级PHP开发框架，是为了敏捷WEB应用开发和简化企业应用开发而诞生的。</p>
<p>ThinkPHP诞生以来一直秉承简洁实用的设计原则，在保持出色的性能和至简的代码的同时，也注重易用性。</p>
<h3 id="选择ThinkPHP-5的原因"><a href="#选择ThinkPHP-5的原因" class="headerlink" title="选择ThinkPHP 5的原因"></a>选择ThinkPHP 5的原因</h3><ul>
<li>采用了全新的架构思想</li>
<li>在ThinkPHP 3的基础上对核心进行了优化</li>
<li>支持composer方式安装</li>
<li>对API进行了大量优化，更符合现代Web开发的方式</li>
<li>国人开发，文档齐全</li>
<li>国内很多软件公司的选择</li>
</ul>
<h3 id="学习MVC开发框架的前置要求"><a href="#学习MVC开发框架的前置要求" class="headerlink" title="学习MVC开发框架的前置要求"></a>学习MVC开发框架的前置要求</h3><ul>
<li>掌握PHP基础，熟悉命名空间的基本用法</li>
<li>掌握PHP面向对象编程的基础知识</li>
<li>熟悉MVC模式</li>
<li>熟悉使用一种关系型数据库管理系统（如MySQL）</li>
<li>对git与composer有一定的了解</li>
</ul>
<h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><h3 id="MVC简介"><a href="#MVC简介" class="headerlink" title="MVC简介"></a>MVC简介</h3><p><strong>MVC模式</strong>(Model-view-controller)是软件工程中的一种<strong>软件架构</strong>模式，把软件系统分为三个基本部分：模型（Model）、视图（View）和控制器（Controller）。</p>
<ul>
<li>模型（Model）：程序员编写程序应有的功能（实现算法等）、数据库专家进行数据管理和数据库设计（可以实现具体的功能）。</li>
<li>视图（View）：界面设计人员进行图形界面设计。</li>
<li>控制器（Controller）：负责转发请求，对请求进行处理。</li>
</ul>
<p>MVC模式的目的是实现一种动态的程序设计，使后续对程序的修改和扩展简化，并且使程序的某一部分的重复利用成为可能。</p>
<p>除此之外，此模式通过对复杂度的简化，使程序结构更加直观。软件系统通过的对自身基本部分分离的同时也赋予了各个基本部分应有的功能。</p>
<h4 id="MVC模式输入输出流程"><a href="#MVC模式输入输出流程" class="headerlink" title="MVC模式输入输出流程"></a>MVC模式输入输出流程</h4><ol>
<li>Controller接收用户输入</li>
<li>Controller调用Model进行业务逻辑处理（控制）</li>
<li>Controller通知/调用View进行界面显示处理（控制）</li>
<li>View根据需要适当参照Model的值</li>
<li>View进行界面显示处理</li>
</ol>
<h4 id="传统开发模式与MVC开发模式的区别"><a href="#传统开发模式与MVC开发模式的区别" class="headerlink" title="传统开发模式与MVC开发模式的区别"></a>传统开发模式与MVC开发模式的区别</h4><h5 id="传统开发模式"><a href="#传统开发模式" class="headerlink" title="传统开发模式"></a>传统开发模式</h5><ul>
<li>显示和业务逻辑处理耦合</li>
<li>业务逻辑和数据操作耦合</li>
<li>显示和数据操作耦合</li>
</ul>
<h5 id="MVC开发模式"><a href="#MVC开发模式" class="headerlink" title="MVC开发模式"></a>MVC开发模式</h5><ul>
<li>结构清晰</li>
<li>职责清晰</li>
<li>不是具体技术，而是一种理念</li>
</ul>
<h4 id="MVC模式的优势"><a href="#MVC模式的优势" class="headerlink" title="MVC模式的优势"></a>MVC模式的优势</h4><ol>
<li><strong>各司其职，互不干涉</strong>——三个层一但哪一层的需求发生了变化，就只需要更改相应层中的代码而不会影响到其他层中的代码。</li>
<li><strong>有利于开发分工</strong>——由于按层把系统分开，那么就能更好的实现开发中的分工。</li>
<li><strong>有利于组件的重用</strong>——分层后更有利于组件的重用。如控制层可独立成一个能用的组件，视图层也可做成通用的操作界面。</li>
</ol>
<h4 id="MVC模式的不足"><a href="#MVC模式的不足" class="headerlink" title="MVC模式的不足"></a>MVC模式的不足</h4><ol>
<li><strong>增加了系统结构和实现的复杂性</strong>——对于简单的界面，严格遵循MVC，使模型、视图与控制器分离，会增加结构的复杂性，并可能产生过多的更新操作，降低运行效率。</li>
<li><strong>视图与控制器间的过于紧密的连接</strong>——视图与控制器是相互分离，但确实联系紧密的部件，视图没有控制器的存在，其应用是很有限的，反之亦然，这样就妨碍了他们的独立重用。</li>
<li><strong>视图对模型数据的低效率访问</strong>——依据模型操作接口的不同，视图可能需要多次调用才能获得足够的显示数据。对未变化数据的不必要的频繁访问，也将损害操作性能。</li>
</ol>
<h4 id="MVC的典型变形"><a href="#MVC的典型变形" class="headerlink" title="MVC的典型变形"></a>MVC的典型变形</h4><p>没有View的API接口开发</p>
<p>Model分层</p>
<h3 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h3><h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><p>应用项目：<a target="_blank" rel="noopener" href="https://github.com/top-think/think">https://github.com/top-think/think</a></p>
<p>核心框架：<a target="_blank" rel="noopener" href="https://github.com/top-think/framework">https://github.com/top-think/framework</a></p>
<p>将核心框架文件夹重命名为thinkphp，然后移动到应用项目的文件夹中即可</p>
<p>可以打开应用项目中public文件夹里的index.php文件测试是否安装成功</p>
<h3 id="模块设计"><a href="#模块设计" class="headerlink" title="模块设计"></a>模块设计</h3><p>tp5.1版本默认采用多模块的架构，并且支持单一模块设计，所有模块的命名空间均以app作为根命名空间（可通过环境变量——config文件夹里的app.php配置文件更改）。</p>
<h4 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h4><h5 id="目录和文件"><a href="#目录和文件" class="headerlink" title="目录和文件"></a>目录和文件</h5><p>目录使用小写+下划线</p>
<p>类的文件名均以命名空间定义，并且命名空间的路径和类库文件所在路径一致</p>
<p><strong>类文件</strong>采用驼峰法命名（首字母大写），其它文件采用小写+下划线命名</p>
<p><strong>类名和类文件名保持一致</strong>，统一采用驼峰法命名（首字母大写）</p>
<h5 id="函数和类、属性名"><a href="#函数和类、属性名" class="headerlink" title="函数和类、属性名"></a>函数和类、属性名</h5><p>类采用驼峰法（首字母大写）</p>
<p>函数使用小写字母和下划线（小写字母开头）</p>
<p>方法使用驼峰法（首字母小写）</p>
<p>属性使用驼峰法（首字母小写）</p>
<p>以双下划线<code>__</code>打头的函数或方法作为魔术方法</p>
<h4 id="模块创建"><a href="#模块创建" class="headerlink" title="模块创建"></a>模块创建</h4><p>在application中创建新的文件夹作为子模块，每个模块文件夹中都有一个controller文件夹，在该文件夹中创建类，然后我们就可以在类里面实现我们想要实现的方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; &#x2F;frontend&#x2F;User&#x2F;login
&lt;?php

namespace app\frontend\controller;

use app\backend\controller\Admin as Back;
class User
&#123;
    function login()&#123;
        echo &quot;吴炜瀚登录成功&quot;;
    &#125;

    function back()&#123;
        $instant &#x3D; new Back();
        return $instant-&gt;hello();
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; &#x2F;backend&#x2F;Admin&#x2F;hello
&lt;?php

namespace app\backend\controller;
class Admin
&#123;
    function hello()&#123;
        return &quot;201841054092登录成功&quot;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们可以用**use…as…**关键字，将其他模块的方法引入到自己模块里，通过实例化后进行调用</p>
<h4 id="模块调用"><a href="#模块调用" class="headerlink" title="模块调用"></a>模块调用</h4><p>我们打开public文件夹里的index.php后，在该url后面加上**/模块名/控制器名/方法名**即可完成方法调用</p>
<p><a target="_blank" rel="noopener" href="http://localhost/thinkPHP/homeworkOne/public/index.php/frontend/User/login">http://localhost/thinkPHP/homeworkOne/public/index.php/frontend/User/login</a></p>
<p>我们也可以通过修改config/app.php文件夹里面的模块设置来简化打开的url</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 默认模块名
&#39;default_module&#39;         &#x3D;&gt; &#39;frontend&#39;,
&#x2F;&#x2F; 禁止访问模块
&#39;deny_module_list&#39;       &#x3D;&gt; [&#39;common&#39;],
&#x2F;&#x2F; 默认控制器名
&#39;default_controller&#39;     &#x3D;&gt; &#39;User&#39;,
&#x2F;&#x2F; 默认操作名
&#39;default_action&#39;         &#x3D;&gt; &#39;login&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://localhost/thinkPHP/homeworkOne/public/">http://localhost/thinkPHP/homeworkOne/public/</a></p>
<p>注意：common是一个特殊的模块，一般用于放置一些公共的类库用于其他模块的重用或者继承，因此我们默认禁止直接访问该文件</p>
<h4 id="调试模式"><a href="#调试模式" class="headerlink" title="调试模式"></a>调试模式</h4><p>我们可以将app配置文件中的应用调试模式设置为true，这样在报错时就可以看到具体的错误</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 应用调试模式
&#39;app_debug&#39;              &#x3D;&gt; true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="惯例配置"><a href="#惯例配置" class="headerlink" title="惯例配置"></a>惯例配置</h4><p>ThinkPHP追寻惯例重于配置的原则，系统会按照一下顺序来加载配置文件（配置的优先顺序从右到左）</p>
<p>惯例配置-&gt;应用配置-&gt;模块配置-&gt;动态配置</p>
<ul>
<li>惯例配置：核心框架内置的配置文件，无需更改。</li>
<li>应用配置：每个应用的全局配置文件（框架安装后会生成初始的应用配置文件），有部分配置参数仅能在应用配置文件中设置。</li>
<li>模块配置：每个模块的配置文件（相同的配置参数会覆盖应用配置），有部分配置在参数模块配置中是无效的，因为已经使用过。</li>
<li>动态配置：主要是指在控制器或行为中进行（动态）更改配置，改配置方式只在当次请求有效，因为不会保存到配置文件中。</li>
</ul>
<p>与5.0版本最大的区别是：5.1版本的配置参数全部是二级配置，当没有制定一级配置名的时候，默认就是以app作为一级配置，一级配置名称通常来说就是所在的配置文件名。</p>
<h4 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h4><p>默认配置都在应用配置目录application下的config文件夹的app.php配置文件中，并且配置参数区分大小写。</p>
<h5 id="扩展配置"><a href="#扩展配置" class="headerlink" title="扩展配置"></a>扩展配置</h5><p>在config文件夹中知识列出了系统内置的配置文件，我们还可以增加其他的自定义配置文件（以email.php为例），配置文件的名称就是一级配置名。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;email.php
&lt;?php
return[
    &#39;username&#39; &#x3D;&gt; &#39;10001@qq.com&#39;,
    &#39;password&#39; &#x3D;&gt; &#39;123456&#39;
];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="模块配置"><a href="#模块配置" class="headerlink" title="模块配置"></a>模块配置</h4><p>我们可以在模块下面创建一个config文件夹，在该文件夹中存放该模块的配置</p>
<p><strong>一但模块目录下存在config目录，则应用配置目录下的模块配置则无效</strong>，也不会对两个目录的配置进行合并</p>
<p>同样，我们也可以在应用配置目录下的config目录下再创建一个名字与模块名一样的文件夹用于存放该模块的配置</p>
<p><strong>涉及到配置参数的定义有效性问题，下列配置参数在模块配置中定义（包括动态配置）无效，必须在应用配置中设置</strong></p>
<table>
<thead>
<tr>
<th>配置参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>app_debug</td>
<td>应用调试模式（支持环境变量配置）</td>
</tr>
<tr>
<td>app_trace</td>
<td>应用trace（支持环境变量配置）</td>
</tr>
<tr>
<td>class_suffix</td>
<td>类后缀</td>
</tr>
<tr>
<td>default_filter</td>
<td>默认过滤机制</td>
</tr>
<tr>
<td>root_namespace</td>
<td>根命名空间</td>
</tr>
<tr>
<td>pathinfo_depr</td>
<td>PATH_INFO分隔符</td>
</tr>
<tr>
<td>uri_route_must</td>
<td>路由强制模式</td>
</tr>
<tr>
<td>auto_bind_must</td>
<td>路由强制模式</td>
</tr>
<tr>
<td>default_lang</td>
<td>默认语言</td>
</tr>
<tr>
<td>lang_switch_on</td>
<td>多语言切换</td>
</tr>
</tbody></table>
<h4 id="配置读取"><a href="#配置读取" class="headerlink" title="配置读取"></a>配置读取</h4><h5 id="Config类"><a href="#Config类" class="headerlink" title="Config类"></a>Config类</h5><p>要使用Config类需要先在类文件中引入</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">use think\facade\Config;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们可以用Config类来读取文件中的配置信息</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function getConf()&#123;
    &#x2F;&#x2F;读取所有的配置参数
    dump(Config::get());
    &#x2F;&#x2F;读取某个一级配置的所有配置参数
    dump(Config::get(&#39;app.&#39;));
    dump(Config::pull(&#39;app&#39;));
    &#x2F;&#x2F;读取特定配置参数的值
    dump(Config::get(&#39;app.default_controller&#39;));
    &#x2F;&#x2F;判断某个设置参数是否存在
    dump(Config::has(&#39;app.default_controller&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中get()方法与pull()方法的输出内容一样，只不过get方法要在文件名后面加一个 . ，而pull()方法只需要传入文件名即可</p>
<h5 id="助手函数"><a href="#助手函数" class="headerlink" title="助手函数"></a>助手函数</h5><p>系统定义了一个助手函数config</p>
<p>我们可以调用config()方法来读取配置文件中的配置信息</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function test()&#123;
        &#x2F;&#x2F;读取全部配置文件
        $configs &#x3D; config();
        var_dump($configs);

        &#x2F;&#x2F;读取应用文件配置
        $appConfig &#x3D; config(&#39;app.&#39;);
        var_dump($appConfig);

        &#x2F;&#x2F;读取日志文件配置
        $logConfig &#x3D; config(&#39;log.&#39;);
        var_dump($logConfig);

        &#x2F;&#x2F;读取特定文件配置
        $appConfig &#x3D; config(&#39;app.app_name&#39;);
        var_dump($appConfig);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="URL和路由"><a href="#URL和路由" class="headerlink" title="URL和路由"></a>URL和路由</h2><h3 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h3><h4 id="单一入口"><a href="#单一入口" class="headerlink" title="单一入口"></a>单一入口</h4><p>ThinkPHP采用单一入口模式进行部署和访问，无论完成什么功能，一个应用都有一个统一（但不一定是唯一）的入口。</p>
<p>应该说，所有应用都是从入口文件开始的，并且不同应用的入口文件是类似的。</p>
<h4 id="单一入口的优势"><a href="#单一入口的优势" class="headerlink" title="单一入口的优势"></a>单一入口的优势</h4><ol>
<li>整体项目较为规范。同一入口往往其不同操作之间具有相同的规则。</li>
<li>控制较为灵活。拦截方便，譬如一些权限控制、用户登录方面的判断和操作可以统一处理。</li>
<li>所有网站都通过一个入口文件进行访问不会造成太大的压力。</li>
</ol>
<h4 id="入口文件"><a href="#入口文件" class="headerlink" title="入口文件"></a>入口文件</h4><p>5.1的默认应用入口文件位于<strong>public/index.php</strong></p>
<h4 id="隐藏入口文件"><a href="#隐藏入口文件" class="headerlink" title="隐藏入口文件"></a>隐藏入口文件</h4><ol>
<li><p>找到PHP环境里apache配置里的<strong>httpd.conf</strong>，打开配置（去掉#）LoadModule rewrite_module modules/mod_rewrite.so</p>
</li>
<li><p>找到PHP环境里apache配置里的<strong>httpd-vhosts.conf</strong>，添加配置</p>
</li>
</ol>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VirtualHost</span> <span class="token attr-name"><span class="token namespace">*:</span>80</span><span class="token punctuation">></span></span>
    ServerName localhost
    DocumentRoot D:/wamp64/www
    &lt;Directory "D:/wamp64/www/">
        Options +Indexes +FollowSymLinks +MultiViews
        AllowOverride All
        Require local
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Directory</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VirtualHost</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>​        如果我们想使用域名的方式访问ThinkPHP5的项目，我们可以将目录的路径改变为框架中public文件夹的路径</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VirtualHost</span> <span class="token attr-name"><span class="token namespace">*:</span>80</span><span class="token punctuation">></span></span>
    ServerName www.tp5.com
    DocumentRoot D:\wamp64\www\thinkPHP\lesson\public
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Directory</span> <span class="token attr-name"><span class="token namespace">"D:</span>\wamp64\www\thinkPHP\lesson\public"</span><span class="token punctuation">></span></span>
        Options +Indexes +FollowSymLinks +MultiViews
        AllowOverride All
        Require local
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Directory</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VirtualHost</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>​        然后在C:\Windows\System32\drivers\etc文件夹中的hosts文件中添加配置</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">#
127.0.0.1 localhost
::1 localhost
192.168.30.128 root
127.0.0.1 www.tp5.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>修改完配置文件需要重启wamp服务</li>
</ol>
<p>此时我们就已经能用<a target="_blank" rel="noopener" href="http://www.tp5.com直接进入项目的index.php欢迎页面/">www.tp5.com直接进入项目的index.php欢迎页面</a></p>
<p>如果上述方法执行失败的话还需要在.htaccess定义重写规则（public\ .htaccess ），详情可见开发者文档URL重写</p>
<h4 id="入口文件的绑定"><a href="#入口文件的绑定" class="headerlink" title="入口文件的绑定"></a>入口文件的绑定</h4><h5 id="对入口文件进行修改（不推荐）"><a href="#对入口文件进行修改（不推荐）" class="headerlink" title="对入口文件进行修改（不推荐）"></a>对入口文件进行修改（不推荐）</h5><p>直接在初始的index.php入口文件中将</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Container::get(&#39;app&#39;)-&gt;run()-&gt;send();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改为</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Container::get(&#39;app&#39;)-&gt;bind(&#39;admin&#39;)-&gt;run()-&gt;send();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>则我们初始的控制器就会被绑定为admin</p>
<h5 id="增加新的入口文件"><a href="#增加新的入口文件" class="headerlink" title="增加新的入口文件"></a>增加新的入口文件</h5><p>直接将初始的index.php入口文件复制并且重命名为admin.php</p>
<p>此时我们就可以从新复制出来的admin.php进入项目，进入的url为</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>路由是应用开发中比较关键的一个环节，其主要作用包括但不限于：</p>
<ul>
<li>让URL更规范以及优雅</li>
<li>隐式传入额外的请求参数</li>
<li>统一拦截并进行权限检查等操作（例如登录验证操作）</li>
<li>绑定请求数据（GET、POST）</li>
<li>使用请求缓存</li>
<li>路由中间件支持（5.1.6版本以上）</li>
</ul>
<p>路由解析的过程一般包括：</p>
<ul>
<li>路由定义：完成路由规则的定义和参数的设置</li>
<li>路由检测：检查当前的URL请求是否有匹配的路由</li>
<li>路由解析：解析当前路由实际对应的操作（方法或闭包）</li>
<li>路由调度：执行路由解析的结果调度（主业务逻辑）</li>
</ul>
<h4 id="强制路由（不推荐）"><a href="#强制路由（不推荐）" class="headerlink" title="强制路由（不推荐）"></a>强制路由（不推荐）</h4><p>在应用配置app.php中设置’url_route_must’=&gt;true，将开启强制使用路由。开启此配置之后必须严格给每一个访问地址定义路由规则（<strong>包括首页</strong>），否则将抛出异常。</p>
<p>修改之前我们可以直接使用域名<strong>tp5.com</strong>进入项目，修改之后再访问该域名则会报错：当前访问路由未定义或不匹配。</p>
<p>我们也可以在route文件夹中的route.php进行修改，首页的路由规则采用 / 定义即可。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
Route::get(&#39;think&#39;, function () &#123;
    return &#39;hello,ThinkPHP5!&#39;;
&#125;);

Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;);

return [

];
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们也可在route文件夹中注册一个路由文件api.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
&#x2F;&#x2F;这里使用get方式访问，同样也可以使用post方式访问
Route::get(&#39;alipay&#39;, function () &#123;
    return &#39;使用支付宝支付&#39;;
&#125;);

return [

];
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意：在路由中定义了新的路由方式会使之前默认的路由方式失效</p>
<p>我们配置路由：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;home&#39;,&#39;index&#x2F;index&#x2F;index&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>再次访问<a target="_blank" rel="noopener" href="http://www.tp5.com/index/index/index">http://www.tp5.com/index/index/index</a> ，报错：<em>非法请求:index/index/index</em></p>
<p>此时只能通过<a target="_blank" rel="noopener" href="http://www.tp5.com/home%E8%BF%9B%E5%85%A5%E5%88%B0%E8%AF%A5%E9%A1%B5%E9%9D%A2%E4%B8%AD">http://www.tp5.com/home进入到该页面中</a></p>
<h4 id="变量规则"><a href="#变量规则" class="headerlink" title="变量规则"></a>变量规则</h4><p>可以通过定义正则表达式来规范传入的参数</p>
<p>我们在模块中定义方法，并且传入参数id，可以直接在路由中访问</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function getUser($id)&#123;
    return &quot;id为$id&quot;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>我们再次从route/api.php定义路由去简化访问方式（:id表示动态地传入参数）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;user&#x2F;:id&#39;, &#39;index&#x2F;index&#x2F;getUser&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此时再次用原来的方式访问则报错<em>非法请求:index/Index/getUser/id/5</em></p>
<h5 id="全局变量规则"><a href="#全局变量规则" class="headerlink" title="全局变量规则"></a>全局变量规则</h5><p>全局变量规则对全部路由都生效</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;设置ID的变量规则
Route::pattern(&#39;id&#39;,&#39;\d+&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>此时输出的参数会只有符合变量规则的数字</p>
<p>当传入的参数没有符合变量规则的存在，则报错</p>
<p>参数可以传入一个<strong>数组</strong>来实现批量添加变量规则</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::pattern([
    &#39;name&#39; &#x3D;&gt; &#39;\w+&#39;,
    &#39;id&#39;   &#x3D;&gt; &#39;\d+&#39;,
]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="局部变量规则"><a href="#局部变量规则" class="headerlink" title="局部变量规则"></a>局部变量规则</h5><p>局部变量规则仅对当前设置的路由生效，并且优先级更高</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;user&#x2F;:id&#39;, &#39;index&#x2F;index&#x2F;getUser&#39;)
        -&gt;pattern([&#39;id&#39;&#x3D;&gt;&#39;[a-zA-Z]+&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>不需要开头添加<code>^</code>或者在最后添加<code>$</code>，也不支持模式修饰符，系统会自动添加。</p>
<h5 id="组合变量规则"><a href="#组合变量规则" class="headerlink" title="组合变量规则"></a>组合变量规则</h5><p>若路由规则较为特殊，可定义组合变量规则</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function getUserinfo()&#123;
    return &quot;组合变量&quot;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>组合变量的优势是路由规则中<strong>没有固定的分隔符</strong>，<strong>可以随意组合</strong>需要的变量规则和分割符</p>
<p>在变量后加上一个？表示此变量为可选变量</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;userinfo-&lt;id&gt;&#x2F;&lt;name?&gt;&#39;,&#39;index&#x2F;index&#x2F;getUserinfo&#39;)
        -&gt;parttern([&#39;id&#39;&#x3D;&gt;&#39;\d+&#39;,&#39;name&#39;&#x3D;&gt;&#39;[a-zA-Z]+&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://www.tp5.com/userinfo-2/a">http://www.tp5.com/userinfo-2/a</a></p>
<p><a target="_blank" rel="noopener" href="http://www.tp5.com/userinfo-2">http://www.tp5.com/userinfo-2</a></p>
<p>以上两个连接都可以访问到getUserinfo()方法</p>
<p>在TP5.1中我们可以直接使用以下方法定义组合变量</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;userinfo&#x2F;:id-&#x2F;:name?&#39;,&#39;index&#x2F;index&#x2F;getUserinfo&#39;)
        -&gt;parttern([&#39;id&#39;&#x3D;&gt;&#39;\d+&#39;,&#39;name&#39;&#x3D;&gt;&#39;[a-zA-Z]+&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://www.tp5.com/userinfo/2-/a">http://www.tp5.com/userinfo/2-/a</a></p>
<p><a target="_blank" rel="noopener" href="http://www.tp5.com/userinfo-2">http://www.tp5.com/userinfo-2</a></p>
<h5 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h5><p>可以把路由规则中的变量传入路由地址中，就可以实现一个动态路由</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;:name&#x2F;hello&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="路由地址"><a href="#路由地址" class="headerlink" title="路由地址"></a>路由地址</h4><h5 id="路由到模块-控制器-操作"><a href="#路由到模块-控制器-操作" class="headerlink" title="路由到模块/控制器/操作"></a>路由到模块/控制器/操作</h5><p>最常用的一种路由方式</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;路由到app.php中的默认模块
Route::get(&#39;&#x2F;home&#39;,&#39;&#39;);
&#x2F;&#x2F;路由到index控制器下的hello操作
Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>路由地址中支持多级控制器（不常用）</p>
<p>我们可以在index/controller目录下创建user文件夹，其中User类如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller\user;
class user
&#123;
    function test()&#123;
        return &#39;多级控制器&#39;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;配置多级控制器路由
Route::get(&#39;group&#39;,&#39;user.user&#x2F;test&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>同样支持路由到动态模块、控制器或者操作</p>
<p><strong>我们可以传入额外的参数</strong></p>
<p>将参数隐式传入需要的操作中，有时能起一定的安全防护作用，在需要的时候才会调用该参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;user&#x2F;:id&#39;, &#39;index&#x2F;index&#x2F;getUser?name&#x3D;admin&#39;)
        -&gt;pattern([&#39;id&#39;&#x3D;&gt;&#39;\d+&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>路由中若没有给出name的值，则name的默认值为null</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function getUser($id,$name&#x3D;&#39;null&#39;)&#123;
        return &quot;id为$id,name为$name&quot;;
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<hr>
<h5 id="路由到操作方法"><a href="#路由到操作方法" class="headerlink" title="路由到操作方法"></a>路由到操作方法</h5><p>与第一种方法差不多，本质的区别是直接执行某个控制器类的方法，而不需要去解析 <strong>模块/控制器/操作</strong>这些，同时也不会去初始化模块（因此不会调用模块的初始化方法）。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;user&#x2F;:id&#39;, &#39;@getUser?name&#x3D;admin&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h5 id="路由到类的方法"><a href="#路由到类的方法" class="headerlink" title="路由到类的方法"></a>路由到类的方法</h5><p>较为繁琐，一般不用</p>
<p><strong>动态方法格式</strong></p>
<p>\类的命名空间\类名@方法名</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;user&#x2F;:id&#39;, &#39;app\index\controller\Index@getUser?name&#x3D;admin&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>静态方法格式</strong></p>
<p>\类的命名空间\类名::方法名</p>
<hr>
<h5 id="路由到重定向地址"><a href="#路由到重定向地址" class="headerlink" title="路由到重定向地址"></a>路由到重定向地址</h5><p>重定向的外部地址必须以“/”或者http开头的地址。</p>
<p>如果路由地址以“/”或者“http”开头则会认为是一个重定向地址或者外部地址</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;路由到操作
Route::get(&#39;user&#x2F;:id&#39;, &#39;@getUser?name&#x3D;admin&#39;);
&#x2F;&#x2F;路由到重定向地址
Route::get(&#39;&#x2F;baidu&#39;,&#39;http:&#x2F;&#x2F;www.baidu.com&#39;);
Route::get(&#39;&#x2F;redirect&#39;,&#39;&#x2F;user&#x2F;30&#39;);

&#x2F;&#x2F;id为30,name为admin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们可以从控制台看到状态码为301，有两种方式可以自己设置状态码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;redirect&#39;,&#39;&#x2F;user&#x2F;30&#39;)-&gt;status(302);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::redirect(&#39;&#x2F;redirect&#39;,&#39;&#x2F;user&#x2F;30&#39;,302);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h5 id="路由到闭包函数"><a href="#路由到闭包函数" class="headerlink" title="路由到闭包函数"></a>路由到闭包函数</h5><p>（实际项目很少用）</p>
<p>我们的路由内可以是一个闭包函数，此函数同样支持参数的传递</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;think&#39;, function () &#123;
    return &#39;hello,ThinkPHP5!&#39;;
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;hello&#x2F;:name&#39;, function ($name) &#123;
    return &#39;Hello,&#39; . $name;
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a>路由参数</h4><p>路由分组及规则定义支持指定路由参数，这些参数主要完成路由匹配检测以及行为执行</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
<th align="left">方法名</th>
</tr>
</thead>
<tbody><tr>
<td align="left">method</td>
<td align="left">请求类型检测，支持多个请求类型</td>
<td align="left">method</td>
</tr>
<tr>
<td align="left">ext</td>
<td align="left">URL后缀检测，支持匹配多个后缀</td>
<td align="left">ext</td>
</tr>
<tr>
<td align="left">deny_ext</td>
<td align="left">URL禁止后缀检测，支持匹配多个后缀</td>
<td align="left">denyExt</td>
</tr>
<tr>
<td align="left">https</td>
<td align="left">检测是否https请求</td>
<td align="left">https</td>
</tr>
<tr>
<td align="left">domain</td>
<td align="left">域名检测</td>
<td align="left">domain</td>
</tr>
<tr>
<td align="left">before</td>
<td align="left">前置行为（检测）</td>
<td align="left">before</td>
</tr>
<tr>
<td align="left">after</td>
<td align="left">后置行为（执行）</td>
<td align="left">after</td>
</tr>
<tr>
<td align="left">merge_extra_vars</td>
<td align="left">合并额外参数</td>
<td align="left">mergeExtraVars</td>
</tr>
<tr>
<td align="left">complete_match</td>
<td align="left">是否完整匹配路由</td>
<td align="left">completeMatch</td>
</tr>
<tr>
<td align="left">model</td>
<td align="left">绑定模型</td>
<td align="left">model</td>
</tr>
<tr>
<td align="left">cache</td>
<td align="left">请求缓存</td>
<td align="left">cache</td>
</tr>
<tr>
<td align="left">param_depr</td>
<td align="left">路由参数分隔符</td>
<td align="left">depr</td>
</tr>
<tr>
<td align="left">ajax</td>
<td align="left">Ajax检测</td>
<td align="left">ajax</td>
</tr>
<tr>
<td align="left">pjax</td>
<td align="left">Pjax检测</td>
<td align="left">pjax</td>
</tr>
<tr>
<td align="left">response</td>
<td align="left">绑定response_send行为</td>
<td align="left">response</td>
</tr>
<tr>
<td align="left">validate</td>
<td align="left">绑定验证器类进行数据验证</td>
<td align="left">validate</td>
</tr>
<tr>
<td align="left">header</td>
<td align="left">设置Response的header信息</td>
<td align="left">header</td>
</tr>
<tr>
<td align="left">append</td>
<td align="left">追加额外的参数（<code>5.1.5+</code>）</td>
<td align="left">append</td>
</tr>
<tr>
<td align="left">middleware</td>
<td align="left">注册路由中间件（<code>5.1.6+</code>）</td>
<td align="left">middleware</td>
</tr>
<tr>
<td align="left">merge_rule_regex</td>
<td align="left">合并路由规则（<code>V5.1.6+</code>）</td>
<td align="left">mergeRuleRegex</td>
</tr>
<tr>
<td align="left">filter</td>
<td align="left">请求变量过滤（<code>V5.1.16+</code>）</td>
<td align="left">filter</td>
</tr>
</tbody></table>
<h5 id="路由参数设置方法"><a href="#路由参数设置方法" class="headerlink" title="路由参数设置方法"></a>路由参数设置方法</h5><p>可批量添加路由参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;ext(&#39;&#39;)
    -&gt;https(false)
    -&gt;domain(&#39;tp5demo.com&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="URL后缀"><a href="#URL后缀" class="headerlink" title="URL后缀"></a>URL后缀</h5><p>URL后缀若是全局统一的话，可以在应用配置文件app.php中设置url_html_suffix参数，若当前访问的URL地址中的URL是允许的伪静态后缀，那么后缀本身是不会被作为参数值传入</p>
<p>url_html_suffix参数设置如下</p>
<table>
<thead>
<tr>
<th align="left">配置值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>false</code></td>
<td align="left">禁止伪静态访问</td>
</tr>
<tr>
<td align="left">空字符串</td>
<td align="left">允许任意伪静态后缀</td>
</tr>
<tr>
<td align="left"><code>html</code></td>
<td align="left">只允许设置的伪静态后缀</td>
</tr>
</tbody></table>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;设置URL后缀检测
Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;ext(&#39;&#39;);
&#x2F;&#x2F;不传入任何值表示不允许使用任何后缀访问<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;匹配多种后缀
Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;ext(&#39;html|shtml&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;设置禁止访问的URL后缀
Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;denyExt(&#39;jpg|png|gif&#39;);
&#x2F;&#x2F;若denyExt不传入任何值则表示必须使用后缀访问<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h5 id="域名检测"><a href="#域名检测" class="headerlink" title="域名检测"></a>域名检测</h5><p>支持使用完整域名或者子域名进行检测</p>
<p>只有输入的url与domain中的域名相匹配时，该路由才会生效</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;domain(&#39;www.tp5.com&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h5 id="HTTPS检测"><a href="#HTTPS检测" class="headerlink" title="HTTPS检测"></a>HTTPS检测</h5><p>检测当前是否使用HTTPS进行访问</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;https(true);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>当该值为空或true时，表示必须使用https进行访问</li>
<li>当该值为false时，表示必须使用http进行访问</li>
</ul>
<hr>
<h5 id="缓存路由请求"><a href="#缓存路由请求" class="headerlink" title="缓存路由请求"></a>缓存路由请求</h5><p>对当前的路由请求进行缓存</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;think&#39;, function () &#123;
    return &#39;hello,ThinkPHP5!&#39;;
&#125;)-&gt;cache(10);&#x2F;&#x2F;缓存10s，即当修改return的内容后，10s后刷新才会生效<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>我们可以将应用配置文件app.php中的route_check_cache设置为true，之后在进行路由缓存的时候就可以在runtime/cache文件夹中查看到缓存的内容</p>
<hr>
<h4 id="跨域请求"><a href="#跨域请求" class="headerlink" title="跨域请求"></a>跨域请求</h4><p>设置跨域请求</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;ext(&#39;html&#39;)
    -&gt;allowCrossDomain();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>跨域请求一般会发送一条<code>OPTIONS</code>的请求，一旦设置了跨域请求的话，不需要自己定义<code>OPTIONS</code>请求的路由，系统会自动加上。</p>
<p>跨域请求系统会默认带上一些Header</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;来源
Access-Control-Allow-Origin:*
&#x2F;&#x2F;方法
Access-Control-Allow-Methods:GET, POST, PATCH, PUT, DELETE
&#x2F;&#x2F;响应头
Access-Control-Allow-Headers:Authorization, Content-Type, If-Match, If-Modified-Since, If-None-Match, If-Unmodified-Since, X-Requested-With<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们可以自定义Header信息（header信息可在浏览器控制台查看）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;hello&#x2F;:name&#39;, &#39;index&#x2F;hello&#39;)
    -&gt;ext(&#39;html&#39;)
    -&gt;header(&#39;Access-Control-Allow-Origin&#39;,&#39;tp5.com&#39;)
    -&gt;header(&#39;Access-Control-Allow-Credentials&#39;, &#39;true&#39;)
    -&gt;allowCrossDomain();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="注解路由"><a href="#注解路由" class="headerlink" title="注解路由"></a>注解路由</h4><p>要使用注解路由要现在app.php中将route_annotation设置为true</p>
<p>我们可以直接在类中建立一个新的方法，并且通过注释的方式直接注册一个路由</p>
<p>传统方法：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;&#x2F;routeTest&#39;,&#39;routeTest&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注解路由：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;**
 * @route(&#39;&#x2F;routeTest&#39;)
 *&#x2F;
function routeTest()&#123;
    return &#39;注解路由&#39;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时我们就可以直接访问</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;**
 * @param  string  $id id
 * @return mixed
 * @route(&#39;user&#x2F;:id&#39;,&#39;get&#39;)
    -&gt;https(false)
    -&gt;pattern([&#39;name&#39;&#x3D;&gt;&#39;\d+&#39;])
 *
 *&#x2F;
public function getUser($id,$name&#x3D;&#39;wwh&#39;)&#123;
    return &quot;id为$id,name为$name&quot;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以在第二个参数中指定请求类型，并且我们可以直接在注解路由后面加上需要的规则</p>
<p>注意：必须严格使用<code>@route(</code>（区分大小写，<code>route</code>和<code>(</code>之间不能有空格），<strong>建议路由定义写在注释最后一段，否则后面需要一个空行</strong>。</p>
<h4 id="路由分组"><a href="#路由分组" class="headerlink" title="路由分组"></a>路由分组</h4><p>该功能允许把相同前缀的路由定义合并分组</p>
<p>优点：简化路由定义；提高路由匹配效率</p>
<p>传统定义路由的方式，每个路由之前都有一个/user开头</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::post(&#39;&#x2F;user&#x2F;login&#39;,&#39;user.user&#x2F;login&#39;);
Route::get(&#39;&#x2F;user&#x2F;query&#39;,&#39;user.user&#x2F;query&#39;);
Route::post(&#39;&#x2F;user&#x2F;add&#39;,&#39;user.user&#x2F;add&#39;);
Route::put(&#39;&#x2F;user&#x2F;edit&#39;,&#39;user.user&#x2F;edit&#39;);
Route::delete(&#39;&#x2F;user&#x2F;delete&#39;,&#39;user.user&#x2F;delete&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>采用路由分组，可以直接将开头的/user提取出来，并且在闭包函数里面注册路由</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;路由分组
Route::group(&#39;&#x2F;user&#39;,function ()&#123;
    Route::post(&#39;&#x2F;login&#39;,&#39;user.user&#x2F;login&#39;);
    Route::get(&#39;&#x2F;query&#39;,&#39;user.user&#x2F;query&#39;);
    Route::post(&#39;&#x2F;add&#39;,&#39;user.user&#x2F;add&#39;);
    Route::put(&#39;&#x2F;edit&#39;,&#39;user.user&#x2F;edit&#39;);
    Route::delete(&#39;&#x2F;delete&#39;,&#39;user.user&#x2F;delete&#39;);
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以使用prefix()方法简化相同路由地址的定义</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::group(&#39;&#x2F;user&#39;,function ()&#123;
    Route::post(&#39;&#x2F;login&#39;,&#39;login&#39;);
    Route::get(&#39;&#x2F;query&#39;,&#39;query&#39;);
    Route::post(&#39;&#x2F;add&#39;,&#39;add&#39;);
    Route::put(&#39;&#x2F;edit&#39;,&#39;edit&#39;);
    Route::delete(&#39;&#x2F;delete&#39;,&#39;delete&#39;);
&#125;)-&gt;prefix(&#39;user.user&#x2F;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>同样，路由分组的方式也支持路由参数和变量规则</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::group(&#39;userinfo&#39;, function () &#123;
    Route::rule(&#39;&#x2F;:id&#39;, &#39;index&#x2F;index&#x2F;getUserinfo&#39;);
    Route::rule(&#39;&#x2F;:name&#39;, &#39;index&#x2F;index&#x2F;getUserinfo&#39;);
&#125;)-&gt;ext(&#39;html&#39;)-&gt;pattern([&#39;id&#39; &#x3D;&gt; &#39;\d+&#39;, &#39;name&#39; &#x3D;&gt; &#39;\w+&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们可以用append()传入额外的参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::group(&#39;userinfo&#39;, function () &#123;
    Route::rule(&#39;&#x2F;:id&#39;, &#39;index&#x2F;index&#x2F;getUserinfo&#39;);
    Route::rule(&#39;&#x2F;:name&#39;, &#39;index&#x2F;index&#x2F;getUserinfo&#39;);
&#125;)-&gt;ext(&#39;html&#39;)-&gt;pattern([&#39;id&#39; &#x3D;&gt; &#39;\d+&#39;, &#39;name&#39; &#x3D;&gt; &#39;\w+&#39;])-&gt;append([&#39;group_id&#39;&#x3D;&gt;1]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的分组路由统一传入了<code>group_id</code>参数，该参数的值可以通过<code>Request</code>类的<code>param</code>方法获取。</p>
<h4 id="延迟路由解析"><a href="#延迟路由解析" class="headerlink" title="延迟路由解析"></a>延迟路由解析</h4><p>定义的路由规则（主要是分组路由和域名路由规则）在加载路由定义文件的时候并没有实际注册，而是在匹配到路由分组或者域名的情况下，才会实际进行注册和解析，大大提高了路由注册和解析的性能。</p>
<p>可以通过app.php的url_lazy_route配置打开延迟路由解析</p>
<p>开启延迟路由解析后，如果需要生成路由反解URL，需要使用命令行指令<strong>php think optimize:route</strong>来生成路由缓存解析。</p>
<h4 id="MISS路由"><a href="#MISS路由" class="headerlink" title="MISS路由"></a>MISS路由</h4><p>在没有匹配到路由规则后执行一条设定好的规则（比较少用，一旦设置相当于开启了强制路由模式）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::miss(&#39;public&#x2F;miss&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>MISS路由同样支持路由分组</p>
<h4 id="资源路由"><a href="#资源路由" class="headerlink" title="资源路由"></a>资源路由</h4><p>支持设置RESTFul请求的资源路由（常用）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;资源路由
Route::resource(&#39;user&#39;,&#39;index&#x2F;user.user&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>注册了一个名为user的路由资源，到index模块下的user/user控制器，系统会自动给我们注册7个路由规则</p>
<table>
<thead>
<tr>
<th>标识</th>
<th>请求类型</th>
<th>生成路由规则</th>
<th>对应操作方法（默认）</th>
</tr>
</thead>
<tbody><tr>
<td>index</td>
<td>GET</td>
<td>user</td>
<td>index</td>
</tr>
<tr>
<td>create</td>
<td>GET</td>
<td>user/create</td>
<td>create</td>
</tr>
<tr>
<td>save</td>
<td>POST</td>
<td>user</td>
<td>save</td>
</tr>
<tr>
<td>read</td>
<td>GET</td>
<td>user/:id</td>
<td>read</td>
</tr>
<tr>
<td>edit</td>
<td>GET</td>
<td>user/:id/edit</td>
<td>edit</td>
</tr>
<tr>
<td>update</td>
<td>PUT</td>
<td>user/:id</td>
<td>update</td>
</tr>
<tr>
<td>delete</td>
<td>DELETE</td>
<td>user/:id</td>
<td>delete</td>
</tr>
</tbody></table>
<p>注册资源路由后，我们就可以在路由指向的控制器中编写相对应的操作</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller\user;
class user
&#123;
    function index()&#123;
        return &#39;获取所有用户数据&#39;;
    &#125;

    function create()&#123;
        return &#39;创建用户&#39;;
    &#125;

    function save()&#123;
        return &#39;保存用户&#39;;
    &#125;

    function read()&#123;
        return &#39;读取用户&#39;;
    &#125;

    function edit($id)&#123;
        return &#39;修改用户id为&#39;.$id;
    &#125;

    function update($id)&#123;
        return &#39;增加用户id为&#39;.$id;
    &#125;

    function delete($id)&#123;
        return &#39;删除用户id为&#39;.$id;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>之后我们就可以直接在REST Client中用对应的路由去访问这些操作</p>
<p>以此类推</p>
<h4 id="快捷路由"><a href="#快捷路由" class="headerlink" title="快捷路由"></a>快捷路由</h4><p>可以快速给控制器注册路由，并且针对不同的请求类型可以设置方法前缀（知道即可）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;快捷路由
Route::controller(&#39;admin&#39;,&#39;admin&#x2F;Admin&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;
class Admin
&#123;
    public function getList()&#123;
        return &#39;获取用户信息&#39;;
    &#125;

    public function getPhone()&#123;
        return &#39;获取电话号码&#39;;
    &#125;

    public function getOne($id)&#123;
        return &#39;id为&#39;.$id;
    &#125;

    public function postInfo()&#123;
        return &#39;postInfo&#39;;
    &#125;

    public function putInfo()&#123;
        return &#39;putInfo&#39;;
    &#125;

    public function deleteInfo()&#123;
        return &#39;deleteInfo&#39;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过观察可以发现，每个方法名都由驼峰命名法命名，前一个单词代表了HTTP的方法，后一个单词代表了路由的资源</p>
<p>访问getList操作：</p>
<p>访问postInfo操作：</p>
<p>当需要传参时，需要额外在路由中加入需要传递的参数，否则会找不到该参数（访问getOne操作）：</p>
<h4 id="路由别名"><a href="#路由别名" class="headerlink" title="路由别名"></a>路由别名</h4><p>路由别名功能能够使用一条规则，批量定义一系列的路由规则（不常用）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; admin 别名路由到 index&#x2F;User 控制器
Route::alias(&#39;admin&#39;,&#39;admin&#x2F;Admin&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>与上述快捷路由不同的是：</p>
<ul>
<li>可以用所有和HTTP方法访问admin模块Admin控制器中的所有方法</li>
<li>在路由中传入的应该是方法的全名</li>
</ul>
<h4 id="路由绑定"><a href="#路由绑定" class="headerlink" title="路由绑定"></a>路由绑定</h4><p>很少使用</p>
<h5 id="绑定到模块-控制器-操作"><a href="#绑定到模块-控制器-操作" class="headerlink" title="绑定到模块/控制器/操作"></a>绑定到模块/控制器/操作</h5><p>可以使用路由绑定简化URL或者路由规则的定义</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 绑定当前的URL到 index模块
Route::bind(&#39;index&#39;);
&#x2F;&#x2F; 绑定当前的URL到 index模块的blog控制器
Route::bind(&#39;index&#x2F;blog&#39;);
&#x2F;&#x2F; 绑定当前的URL到 index模块的blog控制器的read操作
Route::bind(&#39;index&#x2F;blog&#x2F;read&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://servername/index/blog/read/id/5">http://serverName/index/blog/read/id/5</a></p>
<p>简化为<a target="_blank" rel="noopener" href="http://servername/read/id/5">http://serverName/read/id/5</a></p>
<p>若定义了路由</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;index&#x2F;blog&#x2F;:id&#39;,&#39;index&#x2F;blog&#x2F;read&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>则最终可以简化为<a target="_blank" rel="noopener" href="http://servername/5">http://serverName/5</a></p>
<h5 id="绑定到命名空间"><a href="#绑定到命名空间" class="headerlink" title="绑定到命名空间"></a>绑定到命名空间</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 绑定命名空间
Route::bind(&#39;:\app\index\controller&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>那么，我们接下来只需要通过</p>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;serverName&#x2F;blog&#x2F;read&#x2F;id&#x2F;5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>就可以直接访问 <code>\app\index\controller\Blog</code>类的read方法。</p>
<h5 id="绑定到类"><a href="#绑定到类" class="headerlink" title="绑定到类"></a>绑定到类</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 绑定到类
Route::bind(&#39;\app\index\controller\Blog&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>那么，我们接下来只需要通过</p>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;serverName&#x2F;read&#x2F;id&#x2F;5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>就可以直接访问 <code>\app\index\controller\Blog</code>类的read方法。</p>
<p>相关手册：<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353973">https://www.kancloud.cn/manual/thinkphp5_1/353973</a></p>
<hr>
<h4 id="域名路由"><a href="#域名路由" class="headerlink" title="域名路由"></a>域名路由</h4><p>很少使用</p>
<p><a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353976">https://www.kancloud.cn/manual/thinkphp5_1/353976</a></p>
<hr>
<h4 id="URL生成"><a href="#URL生成" class="headerlink" title="URL生成"></a>URL生成</h4><p>使用**\think\facade\Url::build()<strong>方法或</strong>url()**助手函数</p>
<p>Url::build(‘地址表达式’,[‘参数’],[‘URL后缀’],[‘域名’])</p>
<p>url(‘地址表达式’,[‘参数’],[‘URL后缀’],[‘域名’])</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

class Url
&#123;
    function index()&#123;
    	return &#39;index&#39;;
    &#125;
    &#x2F;*
     * 生成URL地址
     * *&#x2F;
    function testUrl()&#123;
        return \think\facade\Url::build(&#39;index&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时访问生成的路由就能访问到该类中的方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

class Url
&#123;
    function delete($id,)&#123;
        return &#39;删除用户id为&#39;.$id;
    &#125;
    &#x2F;*
     * 生成URL地址
     * *&#x2F;
    function testUrl()&#123;
        &#x2F;&#x2F;传入参数的方法
        return \think\facade\Url::build(&#39;delete&#39;,&#39;id&#x3D;2&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>支持数组传入</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function delete($id,$name)&#123;
    return &#39;删除用户id为&#39;.$id.&#39;用户名为&#39;.$name;
&#125;
function testUrl()&#123;
    return \think\facade\Url::build(&#39;delete&#39;,&#39;id&#x3D;2&amp;name&#x3D;wwh&#39;);
    &#x2F;&#x2F;return \think\facade\Url::build(&#39;delete&#39;,[&#39;id&#39;&#x3D;&gt;2,&#39;name&#39;&#x3D;&gt;&#39;wwh&#39;]);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果环境支持REWRITE，那么我们可以更改配置</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#39;url_common_param&#39;&#x3D;&gt;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>之后再次运行则会生成不同的URL</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">\think\facade\Url::build(&#39;delete&#39;,&#39;id&#x3D;2&amp;name&#x3D;wwh&#39;,&#39;shtml&#39;,true);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>加上shtml会使生成的路由为shtml为后缀；加上true会将域名附在路由之前<a target="_blank" rel="noopener" href="http://www.tp5.com/admin/url/delete.shtml?id=2&amp;name=wwh">http://www.tp5.com/admin/url/delete.shtml?id=2&amp;name=wwh</a></p>
<h2 id="请求和响应"><a href="#请求和响应" class="headerlink" title="请求和响应"></a>请求和响应</h2><h3 id="请求对象调用"><a href="#请求对象调用" class="headerlink" title="请求对象调用"></a>请求对象调用</h3><p>当前的请求对象由think\Request类负责，在很多场合下并不需要实例化调用，通常使用依赖注入即可。在其它场合（例如模板输出等）则可以使用think\facade\Request静态类操作</p>
<p>在控制器中通常情况下有两种方式进行<strong>依赖注入</strong></p>
<h4 id="构造方法注入"><a href="#构造方法注入" class="headerlink" title="构造方法注入"></a>构造方法注入</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\index\controller\user;
&#x2F;&#x2F;使用think\Request类
use think\Request;
class user
&#123;
    private $request;
    function __construct(Request $request)
    &#123;
        $this-&gt;request&#x3D;$request;
    &#125;

    function test()&#123;
        &#x2F;&#x2F;会以数组形式返回请求的信息
        dump($this-&gt;request);
        return &#39;多级控制器&#39;;
    &#125;
    
    function edit($id)&#123;
        &#x2F;&#x2F;调用对应方法，可以读取我们想要的信息
        &#x2F;&#x2F;param()方法可以查看所有传参信息
        &#x2F;&#x2F;在param()里面放入参数可以查看特定的参数信息
        dump($this-&gt;request-&gt;param(&quot;id&quot;));
        return &#39;修改用户id为&#39;.$id;
    &#125;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时我们就可以通过调用操作方法来查看当前的请求对象的信息</p>
<p>若我们继承了控制器基类think\Controller，系统就已经自动完成了请求对象的构造方法注入，可以免去写构造方法这一步，直接使用**$this-&gt;request**属性调用当前的请求对象</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller\user;

use think\Controller;
class user extends Controller
&#123;
    protected $request;

    function test()&#123;
        dump($this-&gt;request);
        return &#39;多级控制器&#39;;
    &#125;

    function edit($id)&#123;
        dump($this-&gt;request-&gt;config());
        return &#39;修改用户id为&#39;.$id;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意：因为继承的Controlller类中已经为我们定义了许多参数，所以我们在user类中定义的$request类型需要是protected</p>
<h4 id="操作方法注入"><a href="#操作方法注入" class="headerlink" title="操作方法注入"></a>操作方法注入</h4><p>每个方法中使用依赖注入</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller\user;
use think\Controller;
use think\Request;
class user &#x2F;&#x2F;extends Controller
&#123;
    function login(Request $request,$name)&#123;
        dump($request-&gt;param(&#39;name&#39;));
        return &#39;login&#39;.$name;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>无论是否继承系统的控制器基类，都可以使用操作方法注入</p>
<p>我们可以在REST Client中Request选项的Request Parameters添加参数，之后可以使用param()方法读取</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function save(Request $request)&#123;
	return &#39;保存用户,password&#39;.$request-&gt;param(&#39;password&#39;);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h4 id="Facade调用"><a href="#Facade调用" class="headerlink" title="Facade调用"></a>Facade调用</h4><p>在<strong>没有使用依赖注入</strong>的场合，可以通过Facade机制来<strong>静态调用</strong>请求对象的方法（注意use引入的类库应该是think\facade\Request）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;

use think\facade\Request;
class testRequest
&#123;
    function login($name)&#123;
        return Request::param(&#39;name&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>无法使用依赖注入的场合同样适用</p>
<h4 id="助手函数-1"><a href="#助手函数-1" class="headerlink" title="助手函数"></a>助手函数</h4><p>为了简化调用，系统还提供了**request()**助手函数，可以在任何需要的时候直接调用当前请求对象</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;
&#x2F;&#x2F;需要继承Controller类
use think\Controller;
class testRequest extends Controller
&#123;

    public function index()
    &#123;
        return request()-&gt;param(&#39;name&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="请求对象参数获取"><a href="#请求对象参数获取" class="headerlink" title="请求对象参数获取"></a>请求对象参数获取</h3><h4 id="请求信息"><a href="#请求信息" class="headerlink" title="请求信息"></a>请求信息</h4><p>Request对象支持获取当前的请求信息</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>host</code></td>
<td align="left">当前访问域名或者IP</td>
</tr>
<tr>
<td align="left"><code>scheme</code></td>
<td align="left">当前访问协议</td>
</tr>
<tr>
<td align="left"><code>port</code></td>
<td align="left">当前访问的端口</td>
</tr>
<tr>
<td align="left"><code>remotePort</code></td>
<td align="left">当前请求的REMOTE_PORT</td>
</tr>
<tr>
<td align="left"><code>protocol</code></td>
<td align="left">当前请求的SERVER_PROTOCOL</td>
</tr>
<tr>
<td align="left"><code>contentType</code></td>
<td align="left">当前请求的CONTENT_TYPE</td>
</tr>
<tr>
<td align="left"><code>domain</code></td>
<td align="left">当前包含协议的域名</td>
</tr>
<tr>
<td align="left"><code>subDomain</code></td>
<td align="left">当前访问的子域名</td>
</tr>
<tr>
<td align="left"><code>panDomain</code></td>
<td align="left">当前访问的泛域名</td>
</tr>
<tr>
<td align="left"><code>rootDomain</code></td>
<td align="left">当前访问的根域名（<code>V5.1.6+</code>）</td>
</tr>
<tr>
<td align="left"><code>url</code></td>
<td align="left">当前完整URL</td>
</tr>
<tr>
<td align="left"><code>baseUrl</code></td>
<td align="left">当前URL（不含QUERY_STRING）</td>
</tr>
<tr>
<td align="left"><code>query</code></td>
<td align="left">当前请求的QUERY_STRING参数</td>
</tr>
<tr>
<td align="left"><code>baseFile</code></td>
<td align="left">当前执行的文件</td>
</tr>
<tr>
<td align="left"><code>root</code></td>
<td align="left">URL访问根地址</td>
</tr>
<tr>
<td align="left"><code>rootUrl</code></td>
<td align="left">URL访问根目录</td>
</tr>
<tr>
<td align="left"><code>pathinfo</code></td>
<td align="left">当前请求URL的pathinfo信息（含URL后缀）</td>
</tr>
<tr>
<td align="left"><code>path</code></td>
<td align="left">请求URL的pathinfo信息(不含URL后缀)</td>
</tr>
<tr>
<td align="left"><code>ext</code></td>
<td align="left">当前URL的访问后缀</td>
</tr>
<tr>
<td align="left"><code>time</code></td>
<td align="left">获取当前请求的时间</td>
</tr>
<tr>
<td align="left"><code>type</code></td>
<td align="left">当前请求的资源类型</td>
</tr>
<tr>
<td align="left"><code>method</code></td>
<td align="left">当前请求类型</td>
</tr>
</tbody></table>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;

use think\facade\Request;

class testRequest
&#123;
    public function test()&#123;
        &#x2F;&#x2F;url地址，不带域名
        echo Request::url();
        echo &#39;&lt;br&gt;&#39;;
        &#x2F;&#x2F;url地址，带域名
        echo Request::url(true);
        echo &#39;&lt;br&gt;&#39;;
        &#x2F;&#x2F;当前url，不带域名
        echo Request::baseFile();
        echo &#39;&lt;br&gt;&#39;;
        &#x2F;&#x2F;当前rul，带域名
        echo Request::baseFile(true);
        echo &#39;&lt;br&gt;&#39;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对与上述请求方法一般无需传参，某些方法传入参数true表示获取完整的带域名的地址</p>
<h4 id="输入变量"><a href="#输入变量" class="headerlink" title="输入变量"></a>输入变量</h4><p>可以通过<code>Request</code>对象完成全局输入变量的检测、获取和安全过滤，支持包括<code>$_GET</code>、<code>$_POST</code>、<code>$_REQUEST</code>、<code>$_SERVER</code>、<code>$_SESSION</code>、<code>$_COOKIE</code>、<code>$_ENV</code>等系统变量，以及文件上传信息</p>
<p>需要先引入<strong>use think\facade\Request;</strong></p>
<h5 id="检查函数是否设置"><a href="#检查函数是否设置" class="headerlink" title="检查函数是否设置"></a>检查函数是否设置</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;
&#x2F;&#x2F;必要的类库
use think\facade\Request;
class testRequest
&#123;
    public function test()&#123;
        dump(Request::has(&#39;id&#39;,&#39;get&#39;)) ;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>has()方法，当变量被设置时返回true，未被设置时返回false</p>
<p>变量检测可以支持所有支持的系统变量，包括<code>get/post/put/request/cookie/server/session/env/file</code>。</p>
<h5 id="变量获取"><a href="#变量获取" class="headerlink" title="变量获取"></a>变量获取</h5><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">param</td>
<td align="left">获取当前请求的变量</td>
</tr>
<tr>
<td align="left">get</td>
<td align="left">获取 $_GET 变量</td>
</tr>
<tr>
<td align="left">post</td>
<td align="left">获取 $_POST 变量</td>
</tr>
<tr>
<td align="left">put</td>
<td align="left">获取 PUT 变量</td>
</tr>
<tr>
<td align="left">delete</td>
<td align="left">获取 DELETE 变量</td>
</tr>
<tr>
<td align="left">session</td>
<td align="left">获取 $_SESSION 变量</td>
</tr>
<tr>
<td align="left">cookie</td>
<td align="left">获取 $_COOKIE 变量</td>
</tr>
<tr>
<td align="left">request</td>
<td align="left">获取 $_REQUEST 变量</td>
</tr>
<tr>
<td align="left">server</td>
<td align="left">获取 $_SERVER 变量</td>
</tr>
<tr>
<td align="left">env</td>
<td align="left">获取 $_ENV 变量</td>
</tr>
<tr>
<td align="left">route</td>
<td align="left">获取 路由（包括PATHINFO） 变量</td>
</tr>
<tr>
<td align="left">file</td>
<td align="left">获取 $_FILES 变量</td>
</tr>
</tbody></table>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;
&#x2F;&#x2F;必要的类库
use think\facade\Request;

class testRequest
&#123;
    public function test()&#123;
        dump(Request::get(&#39;id&#39;));
        dump(Request::post(&#39;id&#39;));
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="获取param变量"><a href="#获取param变量" class="headerlink" title="获取param变量"></a>获取param变量</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;

use think\facade\Request;

class testRequest
&#123;
    public function test()&#123;
        &#x2F;&#x2F; 获取当前请求的name变量
        echo Request::param(&#39;name&#39;);echo &#39;&lt;br&gt;&#39;;
        &#x2F;&#x2F; 获取当前请求的所有变量（经过过滤）
        echo Request::param();echo &#39;&lt;br&gt;&#39;;
        &#x2F;&#x2F; 获取当前请求的所有变量（原始数据）
        echo Request::param(false);echo &#39;&lt;br&gt;&#39;;
        &#x2F;&#x2F; 获取当前请求的所有变量（包含上传文件）
        echo Request::param(true);echo &#39;&lt;br&gt;&#39;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>依赖注入的方式</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">namespace app\index\controller;

use think\Request;

class testRequest 
&#123;
	public function test(Request $request)
    &#123;
    	&#x2F;&#x2F; 获取name请求变量
    	return $request-&gt;name;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="支持默认值"><a href="#支持默认值" class="headerlink" title="支持默认值"></a>支持默认值</h5><p>我们获取输入变量时，可以在方法的第二个参数设置一个用于返回的默认值</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;

use think\facade\Request;

class testRequest
&#123;
    public function test()&#123;
        echo Request::param(&#39;name&#39;);&#x2F;&#x2F;返回值为null
        echo Request::param(&#39;name&#39;,&#39;wwh&#39;);&#x2F;&#x2F;输出wwh
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="变量过滤"><a href="#变量过滤" class="headerlink" title="变量过滤"></a>变量过滤</h5><p>我们可以在app.php文件中配置过滤方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 默认全局过滤方法 用逗号分隔多个
&#39;default_filter&#39;         &#x3D;&gt; &#39;htmlspecialchars,strip_tags&#39;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>在过滤时会按照设置的顺序进行过滤</p>
<p>也可以使用Request对象进行全局变量的获取过滤</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Request::filter([&#39;strip_tags&#39;,&#39;htmlspecialchars&#39;])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>也可以在获取变量时添加过滤方法（支持传入多个过滤规则，用逗号隔开）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Request::get(&#39;name&#39;,&#39;&#39;,&#39;htmlspecialchars&#39;);
Request::param(&#39;username&#39;,&#39;&#39;,&#39;strip_tags&#39;);
Request::post(&#39;name&#39;,&#39;&#39;,&#39;org\Filter::safeHtml&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Request对象还支持PHP内置提供的Filter ID过滤</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Request::post(&#39;email&#39;,&#39;&#39;,FILTER_VALIDATE_EMAIL);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>框架对FilterID做了转换支持，因此也可以使用字符串的方式</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Request::post(&#39;email&#39;,&#39;&#39;,&#39;email&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注意：采用Filter ID进行过滤时，若不符合过滤要求，则会返回false，因此我们需要传入默认值来确保最终的值符合规范</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;若不符合规范，返回空字符串
Request::post(&#39;email&#39;,&#39;&#39;,FILTER_VALIDATE_EMAIL);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>若不需要过滤，可以使用null，及时设置了全局过滤</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Request::get(&#39;name&#39;, &#39;&#39;, null); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="获取部分变量"><a href="#获取部分变量" class="headerlink" title="获取部分变量"></a>获取部分变量</h5><p>获取当前请求的部分参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 只获取当前请求的id和name变量
Request::only(&#39;id,name&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;使用数组的方式传入参数
Request::only([&#39;id&#39;,&#39;name&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>支持批量设置默认值</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;id默认值为0，name默认值为空字符串
Request::only([&#39;id&#39;&#x3D;&gt;0,&#39;name&#39;&#x3D;&gt;&#39;&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>默认获取的是当前请求参数（param类型变量），若要获取其他类型的参数，可在第二个参数传入</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 只获取GET请求的id和name变量
Request::only([&#39;id&#39;,&#39;name&#39;], &#39;get&#39;);
&#x2F;&#x2F; 只获取POST请求的id和name变量
Request::only([&#39;id&#39;,&#39;name&#39;], &#39;post&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>也可以用except()排除部分变量后获取</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 排除id和name变量
Request::except(&#39;id,name&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>except()方法的使用方法与传入参数与only()相同</p>
<h5 id="变量修饰符"><a href="#变量修饰符" class="headerlink" title="变量修饰符"></a>变量修饰符</h5><p>能实现简单的过滤变量，获取变量时返回的值只会是符合变量修饰符类型的值</p>
<table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">s</td>
<td align="left">强制转换为字符串类型</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">强制转换为整型类型</td>
</tr>
<tr>
<td align="left">b</td>
<td align="left">强制转换为布尔类型</td>
</tr>
<tr>
<td align="left">a</td>
<td align="left">强制转换为数组类型</td>
</tr>
<tr>
<td align="left">f</td>
<td align="left">强制转换为浮点类型</td>
</tr>
</tbody></table>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;若id的值为10d，使用变量修饰符后只会返回10
Request::get(&#39;id&#x2F;d&#39;);
Request::post(&#39;name&#x2F;s&#39;);
Request::post(&#39;ids&#x2F;a&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="助手函数input"><a href="#助手函数input" class="headerlink" title="助手函数input()"></a>助手函数input()</h5><p>判断变量是否定义</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">input(&#39;?get.id&#39;);
input(&#39;?post.name&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>获取PARAM参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">input(&#39;param.name&#39;); &#x2F;&#x2F; 获取单个参数
input(&#39;param.&#39;); &#x2F;&#x2F; 获取全部参数
&#x2F;&#x2F; 下面是等效的
input(&#39;name&#39;); 
input(&#39;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>获取GET参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 获取单个变量
input(&#39;get.id&#39;);
&#x2F;&#x2F; 使用过滤方法获取 默认为空字符串
input(&#39;get.name&#39;);
&#x2F;&#x2F; 获取全部变量
input(&#39;get.&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用过滤方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">input(&#39;get.name&#39;,&#39;&#39;,&#39;htmlspecialchars&#39;); &#x2F;&#x2F; 获取get变量 并用htmlspecialchars函数过滤
input(&#39;username&#39;,&#39;&#39;,&#39;strip_tags&#39;); &#x2F;&#x2F; 获取param变量 并用strip_tags函数过滤
input(&#39;post.name&#39;,&#39;&#39;,&#39;org\Filter::safeHtml&#39;); &#x2F;&#x2F; 获取post变量 并用org\Filter类的safeHtml方法过滤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>使用变量修饰符</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">input(&#39;get.id&#x2F;d&#39;);
input(&#39;post.name&#x2F;s&#39;);
input(&#39;post.ids&#x2F;a&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>可以用input()获取传过来的信息，例如用户名和密码，再去判断他符不符合我们的规范</p>
<h3 id="请求类型"><a href="#请求类型" class="headerlink" title="请求类型"></a>请求类型</h3><p>在很多情况下面，我们需要判断当前操作的请求类型是<code>GET</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code>或者<code>HEAD</code>，一方面可以针对请求类型作出不同的逻辑处理，另外一方面有些情况下面需要验证安全性，过滤不安全的请求。</p>
<p>请求对象<code>Request</code>类提供了下列方法来获取或判断当前请求类型：</p>
<table>
<thead>
<tr>
<th align="left">用途</th>
<th align="left">方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">获取当前请求类型</td>
<td align="left">method</td>
</tr>
<tr>
<td align="left">判断是否GET请求</td>
<td align="left">isGet</td>
</tr>
<tr>
<td align="left">判断是否POST请求</td>
<td align="left">isPost</td>
</tr>
<tr>
<td align="left">判断是否PUT请求</td>
<td align="left">isPut</td>
</tr>
<tr>
<td align="left">判断是否DELETE请求</td>
<td align="left">isDelete</td>
</tr>
<tr>
<td align="left">判断是否AJAX请求</td>
<td align="left">isAjax</td>
</tr>
<tr>
<td align="left">判断是否PJAX请求</td>
<td align="left">isPjax</td>
</tr>
<tr>
<td align="left">判断是否为JSON请求</td>
<td align="left">isJson（<code>V5.1.38+</code>）</td>
</tr>
<tr>
<td align="left">判断是否手机访问</td>
<td align="left">isMobile</td>
</tr>
<tr>
<td align="left">判断是否HEAD请求</td>
<td align="left">isHead</td>
</tr>
<tr>
<td align="left">判断是否PATCH请求</td>
<td align="left">isPatch</td>
</tr>
<tr>
<td align="left">判断是否OPTIONS请求</td>
<td align="left">isOptions</td>
</tr>
<tr>
<td align="left">判断是否为CLI执行</td>
<td align="left">isCli</td>
</tr>
<tr>
<td align="left">判断是否为CGI模式</td>
<td align="left">isCgi</td>
</tr>
</tbody></table>
<p><code>method</code>方法返回的请求类型始终是大写，这些方法都不需要传入任何参数。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;

use think\facade\Request;

class testRequest
&#123;
    public function test()&#123;
        dump(request()-&gt;isPut());
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="请求类型伪装"><a href="#请求类型伪装" class="headerlink" title="请求类型伪装"></a>请求类型伪装</h4><p>支持请求类型伪装，可以在<code>POST</code>表单里面提交<code>_method</code>变量，传入需要伪装的请求类型</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PUT<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>提交<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>提交后的请求类型会被系统识别为<code>PUT</code>请求</p>
<p>可以设置为任何合法的请求类型，包括<code>GET</code>、<code>POST</code>、<code>PUT</code>和<code>DELETE</code>等，但伪装变量<code>_method</code>只<strong>能通过POST请求进行提交</strong></p>
<p>如果要获取原始的请求类型，可以使用</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Request::method(true);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>在命令行下面执行的话，请求类型返回的始终是<code>GET</code>。</p>
</blockquote>
<p>如果你需要改变伪装请求的变量名，可以修改应用配置文件：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 表单请求类型伪装变量
&#39;var_method&#39;             &#x3D;&gt; &#39;_m&#39;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>AJAX/PJAX伪装很少使用，忽略</strong></p>
<h3 id="响应输出"><a href="#响应输出" class="headerlink" title="响应输出"></a>响应输出</h3><p>Response响应对象由think\Response类或子类完成，，ThinkPHP的响应输出是自动的（命令行模式除外），最终会调用<code>Response</code>对象的<code>send</code>方法完成输出</p>
<p>大多数情况，我们不需要关注<code>Response</code>对象本身，只需要在控制器的操作方法中返回数据即可</p>
<p>最简单的响应输出是直接在路由闭包或者控制器操作方法中返回一个字符串，例如：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route::get(&#39;hello&#x2F;:name&#39;, function ($name) &#123;
    return &#39;Hello,&#39; . $name . &#39;!&#39;;
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\index\controller;

class Index
&#123;
    public function hello($name&#x3D;&#39;thinkphp&#39;)
    &#123;
        return &#39;Hello,&#39; . $name . &#39;!&#39;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以通过修改配置修改响应时输出的类型</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 默认输出类型
&#39;default_return_type&#39;    &#x3D;&gt; &#39;json&#39;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th align="left">输出类型</th>
<th align="left">快捷方法</th>
<th align="left">对应Response类</th>
</tr>
</thead>
<tbody><tr>
<td align="left">HTML输出</td>
<td align="left">response</td>
<td align="left">\think\Response</td>
</tr>
<tr>
<td align="left">渲染模板输出</td>
<td align="left">view</td>
<td align="left">\think\response\View</td>
</tr>
<tr>
<td align="left">JSON输出</td>
<td align="left">json</td>
<td align="left">\think\response\Json</td>
</tr>
<tr>
<td align="left">JSONP输出</td>
<td align="left">jsonp</td>
<td align="left">\think\response\Jsonp</td>
</tr>
<tr>
<td align="left">XML输出</td>
<td align="left">xml</td>
<td align="left">\think\response\Xml</td>
</tr>
<tr>
<td align="left">页面重定向</td>
<td align="left">redirect</td>
<td align="left">\think\response\Redirect</td>
</tr>
<tr>
<td align="left">附件下载（<code>V5.1.21+</code>）</td>
<td align="left">download</td>
<td align="left">\think\response\Download</td>
</tr>
</tbody></table>
<h4 id="返回JSON数据"><a href="#返回JSON数据" class="headerlink" title="返回JSON数据"></a>返回JSON数据</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\index\controller;

class Index
&#123;
    public function hello()
    &#123;
        $data &#x3D; [&#39;name&#39; &#x3D;&gt; &#39;thinkphp&#39;, &#39;status&#39; &#x3D;&gt; &#39;1&#39;];
        return json($data);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="返回HTML格式"><a href="#返回HTML格式" class="headerlink" title="返回HTML格式"></a>返回HTML格式</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\index\controller;

class Index
&#123;
    public function hello()
    &#123;
        $data &#x3D; &#39;Hello,ThinkPHP!&#39;;
        return response($data);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或者当default_return_type配置为html时</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\index\controller;

class Index
&#123;
    public function hello()
    &#123;
        return &#39;Hello,ThinkPHP!&#39;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\index\controller;

class testRequest
&#123;
    public function responseTest()
    &#123;
        return redirect(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以使用with()方法向重定向的地址传入参数</p>
<h2 id="视图和模板"><a href="#视图和模板" class="headerlink" title="视图和模板"></a>视图和模板</h2><h3 id="视图渲染"><a href="#视图渲染" class="headerlink" title="视图渲染"></a>视图渲染</h3><h4 id="控制器基类"><a href="#控制器基类" class="headerlink" title="控制器基类"></a>控制器基类</h4><h5 id="fetch"><a href="#fetch" class="headerlink" title="fetch()"></a>fetch()</h5><p>继承系统控制器基类<strong>\think\Controller</strong>，然后调用fetch方法</p>
<p>模板文件的写法支持下面几种：</p>
<table>
<thead>
<tr>
<th align="left">用法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">不带任何参数</td>
<td align="left">自动定位当前操作的模板文件</td>
</tr>
<tr>
<td align="left">模块@控制器/操作</td>
<td align="left">常用写法，支持跨模块</td>
</tr>
<tr>
<td align="left">完整的模板文件名</td>
<td align="left">直接使用完整的模板文件名（包括模板后缀）</td>
</tr>
</tbody></table>
<p>我们需要在模块内创建view文件夹用于存放模板文件，而后在controller文件夹中编写模板渲染的操作</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;
use think\Controller;

class Admin extends Controller
&#123;
    public function admin_list()&#123;
        &#x2F;&#x2F;指定当前模块默认文件夹的文件
        &#x2F;&#x2F;return $this-&gt;fetch(&#39;list&#39;);
        &#x2F;&#x2F;指定当前模块其他目录的文件
        &#x2F;&#x2F;return $this-&gt;fetch(&#39;user&#x2F;create&#39;);
        &#x2F;&#x2F;指定其他模块的文件
		&#x2F;&#x2F;return $this-&gt;fetch(&#39;index@user&#x2F;show&#39;);
        &#x2F;&#x2F;指定一个存在的文件路径(特殊情况，很少用)
		return $this-&gt;fetch(&#39;..&#x2F;template&#x2F;public&#x2F;index.html&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>fetch中若不传入任何参数，则文件路径的默认值为<strong>当前模块@当前类名/当前操作名</strong></p>
<h4 id="助手函数-2"><a href="#助手函数-2" class="headerlink" title="助手函数"></a>助手函数</h4><p>我们想要使用**fetch()<strong>必须继承Controller基类，若不继承，可以使用助手函数</strong>view()<strong>，助手函数的使用方法与传入参数与</strong>fetch()**相同</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

class Admin
&#123;
    public function admin_list()&#123;
        &#x2F;&#x2F;return view();
        return view(&#39;index@user&#x2F;show&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="直接渲染内容"><a href="#直接渲染内容" class="headerlink" title="直接渲染内容"></a>直接渲染内容</h4><p>直接解析内容而不通过模板文件的话，可以使用display方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">namespace app\admin\controller;

use think\Controller;

class admin extends Controller
&#123;
    public function admin_list()
    &#123;
        &#x2F;&#x2F;用getContent()方法直接获取要渲染的内容
        &#x2F;&#x2F;$content &#x3D; $this-&gt;fetch()-&gt;getContent();
        &#x2F;&#x2F;渲染时可以直接返回
        &#x2F;&#x2F;return $content;
        &#x2F;&#x2F;也可以使用display()方法返回获取道德内容
        &#x2F;&#x2F;return $this-&gt;display($content);
        &#x2F;&#x2F; 直接渲染内容
        $content &#x3D; &#39;&#123;$name&#125;-&#123;$email&#125;&#39;;
        return $this-&gt;display($content, [&#39;name&#39; &#x3D;&gt; &#39;thinkphp&#39;, &#39;email&#39; &#x3D;&gt; &#39;thinkphp@qq.com&#39;]);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="视图赋值与输出"><a href="#视图赋值与输出" class="headerlink" title="视图赋值与输出"></a>视图赋值与输出</h3><p>除了系统变量与配置参数输出无需赋值外，其他变量若要在模板中输出必须先进行赋值操作</p>
<h4 id="assign"><a href="#assign" class="headerlink" title="assign()"></a>assign()</h4><p>使用前先继承<strong>\think\Controller</strong>类</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;
use think\Controller;

class Admin extends Controller
&#123;
    public function admin_list()&#123;
        &#x2F;&#x2F;$this-&gt;assign(&#39;name&#39;,&#39;wwh&#39;);
        &#x2F;&#x2F;$this-&gt;assign(&#39;sex&#39;,&#39;man&#39;);
        &#x2F;&#x2F;如果像上面有多个变量建议使用数组进行批量赋值
        
        &#x2F;&#x2F;$this-&gt;assign([
        &#x2F;&#x2F;    &#39;name&#39;&#x3D;&gt;&#39;wwh&#39;,
        &#x2F;&#x2F;    &#39;sex&#39;&#x3D;&gt;&#39;man&#39;
        &#x2F;&#x2F;]);
        &#x2F;&#x2F;可以给数组命个名
        $this-&gt;assign(&#39;user&#39;,[
            &#39;name&#39;&#x3D;&gt;&#39;wwh&#39;,
            &#39;sex&#39;&#x3D;&gt;&#39;man&#39;
        ]);
        return $this-&gt;fetch();
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>未给数组命名前变量为<strong>普通变量</strong>（如字符串变量）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;普通变量调用
&#123;$name&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>给数组命名后变量为<strong>数组</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;数组调用
&#123;$user.name&#125;
&#x2F;&#x2F;或
&#123;$user[&#39;name&#39;]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们可以将各种变量赋给一个<strong>对象</strong>，再使用对象来输出</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;利用\stdClass预定义类写入参数
$user &#x3D; new \stdClass();
$user-&gt;name&#x3D;&#39;wwh&#39;;
$user-&gt;sex&#x3D;&#39;man&#39;;

$this-&gt;assign(&#39;user&#39;,$user);

&#x2F;&#x2F;或实例化外部的类
$this-&gt;assign(&#39;person&#39;,new Person());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\admin\controller;

class Person
&#123;
    &#x2F;&#x2F;静态变量
    static $type &#x3D; &#39;type&#39;;
    &#x2F;&#x2F;常量
    const TYPE &#x3D; &#39;TYPE&#39;;
    &#x2F;&#x2F;方法
    function show()&#123;
        return &#39;Person show&#39;;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">调用对象用户名：&#123;$user-&gt;name&#125;&lt;br&gt;
调用常量：&#123;$person::TYPE&#125;&lt;br&gt;
调用静态变量：&#123;$person::$type&#125;&lt;br&gt;
调用方法：&#123;$person-&gt;show()&#125;&lt;br&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="方法传入参数"><a href="#方法传入参数" class="headerlink" title="方法传入参数"></a>方法传入参数</h4><p>在方法fetch()与display()的第二个参数可以直接传入模板变量</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;
use think\Controller;

class Admin extends Controller
&#123;
    public function admin_list()&#123;
         return $this-&gt;fetch(&#39;admin_list&#39;, [
            &#39;name&#39;  &#x3D;&gt; &#39;wwh&#39;,
            &#39;sex&#39; &#x3D;&gt; &#39;man&#39;
        ]);
        &#x2F;*
         *$content &#x3D; &#39;&#123;$name&#125;-&#123;$sex&#125;&#39;;
         *return $this-&gt;display($content, [
         *	&#39;name&#39;  &#x3D;&gt; &#39;wwh&#39;,
         *	&#39;sex&#39; &#x3D;&gt; &#39;man&#39;
        ]);*&#x2F;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="助手函数-3"><a href="#助手函数-3" class="headerlink" title="助手函数"></a>助手函数</h4><p>助手函数view内可以传入属性，也可以传入对象，传入的参数不同，视图调用的方法也不同</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

class Admin
&#123;
    public function admin_list()&#123;
        &#x2F;&#x2F;return view(&#39;admin_list&#39;, [
        &#x2F;&#x2F;    &#39;name&#39;  &#x3D;&gt; &#39;wwh&#39;,
        &#x2F;&#x2F;    &#39;sex&#39; &#x3D;&gt; &#39;man&#39;
        &#x2F;&#x2F;]);
    
        &#x2F;&#x2F;利用\stdClass预定义类写入参数
        $user &#x3D; new \stdClass();
        $user-&gt;name&#x3D;&#39;wwh&#39;;
        $user-&gt;sex&#x3D;&#39;man&#39;;
    
        return view(&#39;admin_list&#39;,[
            &#39;user&#39;&#x3D;&gt;$user,
            &#39;person&#39;&#x3D;&gt;new Person()
            
             return view(&#39;admin_list&#39;)-&gt;assign(&#39;user&#39;,$user)-&gt;assign(&#39;person&#39;,new Person());
        ]);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或者可以使用助手函数view()与assign()相结合，可以使用assign()向视图内不断地传入变量</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

class Admin
&#123;
    public function admin_list()&#123;
   		$user &#x3D; new \stdClass();
        $user-&gt;name&#x3D;&#39;wwh&#39;;
        $user-&gt;sex&#x3D;&#39;man&#39;;
        return view(&#39;admin_list&#39;)-&gt;assign(&#39;user&#39;,$user)-&gt;assign(&#39;person&#39;,new Person());
        ]);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="公共模板变量赋值"><a href="#公共模板变量赋值" class="headerlink" title="公共模板变量赋值"></a>公共模板变量赋值</h4><p>如果需要在控制器之外进行模板变量赋值，可以使用视图类的<code>share</code>静态方法进行全局公共模板变量赋值</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

use think\Controller;
&#x2F;&#x2F;使用公共模板必须先引入该类库
use think\facade\View;
class Admin extends Controller
&#123;
    public function admin_list()&#123;
        $user &#x3D; new \stdClass();
        $user-&gt;name&#x3D;&#39;wwh&#39;;
        $user-&gt;sex&#x3D;&#39;man&#39;;

        View::share([
            &#39;user&#39;&#x3D;&gt;$user,
            &#39;person&#39;&#x3D;&gt;new Person()
        ]);
        return $this-&gt;fetch();
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>全局静态模板变量最终会和前面使用方法赋值的模板变量合并</p>
<h3 id="变量替换"><a href="#变量替换" class="headerlink" title="变量替换"></a>变量替换</h3><p>支持对模板文件输出的内容进行字符替换，定义后在渲染模板或者内容输出的时候就会自动根据设置的替换规则自动替换</p>
<p>5.1系统没有任何内置的替换规则</p>
<p>如果需要全局替换的话，可以直接在template.php配置文件中添加：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 变量替换规则
&#39;tpl_replace_string&#39; &#x3D;&gt; [
    &#39;__STATIC__&#39;&#x3D;&gt;&#39;&#x2F;static&#39;,
    &#39;__JS__&#39; &#x3D;&gt; &#39;&#x2F;static&#x2F;javascript&#39;,
    &#39;__CSS__&#39; &#x3D;&gt; &#39;&#x2F;static&#x2F;css&#39;
]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>替换规则严格区分大小写</p>
<h4 id="替换代码"><a href="#替换代码" class="headerlink" title="替换代码"></a>替换代码</h4><p>在public/static文件夹中创建css文件admin_list.css</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>之后直接在视图文件中引入css文件即可生效</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/css/admin_list.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注意：css中外部链接的优先级会比较低，如果存在多个同名的样式，其行内样式和内部样式会先生效</p>
<p><strong>JS文件同理</strong></p>
<h3 id="变量输出"><a href="#变量输出" class="headerlink" title="变量输出"></a>变量输出</h3><p>有一部分内容在**视图渲染与输出的assign()**中</p>
<h4 id="使用默认值"><a href="#使用默认值" class="headerlink" title="使用默认值"></a>使用默认值</h4><p>我们可以给变量输出提供默认值，当该变量获取不到时，会输出设置的默认值</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;$user.age|default&#x3D;20&#125;
&#x2F;&#x2F;对系统变量也支持
&#123;$Think.get.name|default&#x3D;&quot;名称为空&quot;&#125;
&#x2F;&#x2F;默认值与函数可同时使用
&#123;$Think.get.name|getName|default&#x3D;&quot;名称为空&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="系统变量输出"><a href="#系统变量输出" class="headerlink" title="系统变量输出"></a>系统变量输出</h4><p>普通的模板变量需要首先赋值后才能在模板中输出，但是系统变量则不需要，可以直接在模板中输出，系统变量的输出通常以<code>&#123;$Think.</code>（大小写一致） 打头</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;$Think.server.script_name&#125; &#x2F;&#x2F; 输出$_SERVER[&#39;SCRIPT_NAME&#39;]变量
&#123;$Think.session.user_id&#125; &#x2F;&#x2F; 输出$_SESSION[&#39;user_id&#39;]变量
&#123;$Think.get.page&#125; &#x2F;&#x2F; 输出$_GET[&#39;page&#39;]变量
&#123;$Think.cookie.name&#125;  &#x2F;&#x2F; 输出$_COOKIE[&#39;name&#39;]变量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>支持输出 <code>$_SERVER</code>、<code>$_ENV</code>、 <code>$_POST</code>、 <code>$_GET</code>、 <code>$_REQUEST</code>、<code>$_SESSION</code>和 <code>$_COOKIE</code>变量。</p>
<h5 id="常量输出"><a href="#常量输出" class="headerlink" title="常量输出"></a>常量输出</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;$Think.const.PHP_VERSION&#125;&#x2F;&#x2F;或&#123;$Think.PHP_VERSION&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="配置输出"><a href="#配置输出" class="headerlink" title="配置输出"></a>配置输出</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;$Think.config.default_module&#125;
&#123;$Think.config.default_controller&#125;
&#x2F;&#x2F;上面默认搜索的是app.php文件中的配置，若想输出其他配置文件的配置可以使用以下方法
&#123;$Think.config.template.view_suffix&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="使用函数"><a href="#使用函数" class="headerlink" title="使用函数"></a>使用函数</h4><p>可以使用函数对输出的值进行规范</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

use think\Controller;
use think\facade\View;
class Admin extends Controller
&#123;
    public function admin_list()&#123;
        &#x2F;&#x2F;利用\stdClass预定义类写入参数，调用时要使用箭头
        $user &#x3D; new \stdClass();
        $user-&gt;name&#x3D;&#39;wwh&#39;;
        $user-&gt;sex&#x3D;&#39;man&#39;;
        $user-&gt;password&#x3D;123456;
        $user-&gt;addr&#x3D;&#39;集美大学诚毅学院十三号宿舍楼211&#39;;

        View::share([
            &#39;user&#39;&#x3D;&gt;$user
        ]);
        return $this-&gt;fetch();
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php+html" data-language="php+html"><code class="language-php+html">&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;&#x2F;title&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
    姓名：&#123;$user-&gt;name|upper&#125;&lt;br&gt;
    地址：&#123;$user-&gt;addr|default&#x3D;&#39;无&#39;|mb_substr&#x3D;0,8&#125;&lt;br&gt;
    密码：&#123;$user-&gt;password|md5&#125;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th align="left">过滤方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">date</td>
<td align="left">日期格式化（支持各种时间类型）</td>
</tr>
<tr>
<td align="left">format</td>
<td align="left">字符串格式化</td>
</tr>
<tr>
<td align="left">upper</td>
<td align="left">转换为大写</td>
</tr>
<tr>
<td align="left">lower</td>
<td align="left">转换为小写</td>
</tr>
<tr>
<td align="left">first</td>
<td align="left">输出数组的第一个元素</td>
</tr>
<tr>
<td align="left">last</td>
<td align="left">输出数组的最后一个元素</td>
</tr>
<tr>
<td align="left">default</td>
<td align="left">默认值</td>
</tr>
<tr>
<td align="left">raw</td>
<td align="left">不使用（默认）转义</td>
</tr>
<tr>
<td align="left">md5</td>
<td align="left">将字符串加密</td>
</tr>
<tr>
<td align="left">substr</td>
<td align="left">从x开始截取x位字符</td>
</tr>
<tr>
<td align="left">mb_substr</td>
<td align="left">与上面相同，不同在于他将汉字当作一个字符</td>
</tr>
</tbody></table>
<p>使用函数通过解析后，其根本是使用php的各种函数对字符串进行处理，支持多个函数一起使用，用|隔开</p>
<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><p>模板输出支持运算符</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">使用示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>+</code></td>
<td align="left"><code>&#123;$a+$b&#125;</code></td>
</tr>
<tr>
<td align="left"><code>-</code></td>
<td align="left"><code>&#123;$a-$b&#125;</code></td>
</tr>
<tr>
<td align="left"><code>*</code></td>
<td align="left"><code>&#123;$a*$b&#125;</code></td>
</tr>
<tr>
<td align="left"><code>/</code></td>
<td align="left"><code>&#123;$a/$b&#125;</code></td>
</tr>
<tr>
<td align="left"><code>%</code></td>
<td align="left"><code>&#123;$a%$b&#125;</code></td>
</tr>
<tr>
<td align="left"><code>++</code></td>
<td align="left"><code>&#123;$a++&#125;</code> 或 <code>&#123;++$a&#125;</code></td>
</tr>
<tr>
<td align="left"><code>--</code></td>
<td align="left"><code>&#123;$a--&#125;</code> 或<code>&#123;--$a&#125;</code></td>
</tr>
<tr>
<td align="left">综合运算</td>
<td align="left"><code>&#123;$a+$b*10+$c&#125;</code></td>
</tr>
</tbody></table>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;$user.score+10&#125; &#x2F;&#x2F;正确的
&#123;$user[&#39;score&#39;]+10&#125; &#x2F;&#x2F;正确的
&#123;$user[&#39;score&#39;]*$user[&#39;level&#39;]&#125; &#x2F;&#x2F;正确的
&#123;$user[&#39;score&#39;]|myFun*10&#125; &#x2F;&#x2F;错误的
&#123;$user[&#39;score&#39;]+myFun($user[&#39;level&#39;])&#125; &#x2F;&#x2F;正确的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h5><p>支持三元运算符</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">性别：&#123;$user-&gt;sex&#x3D;&#x3D;&#39;man&#39;?&#39;男&#39;:&#39;女&#39;&#125;&lt;br&gt;&#x2F;&#x2F;男，?前表达式为真输出第一个，否则输出第二个<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>特殊写法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;表示如果有设置$name则输出$name,否则输出默认值
&#123;$name ?? &#39;默认值&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;表示$name为真时才输出默认值
&#123;$name?&#x3D;&#39;默认值&#39;&#125; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;表示如果$name为真则输出$name，否则输出NO
&#123;$name ?: &#39;NO&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h3 id="模板注释"><a href="#模板注释" class="headerlink" title="模板注释"></a>模板注释</h3><h4 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释"></a>单行注释</h4><p>注意<code>&#123;</code>和注释标记之间不能有空格。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;&#x2F;* 注释内容 *&#x2F; &#125; 或 &#123;&#x2F;&#x2F; 注释内容 &#125; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;&#x2F;* 这是模板
注释内容*&#x2F; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>模板注释支持多行，模板注释在生成编译缓存文件后会自动删除，这一点和Html的注释不同</p>
<h3 id="原样输出"><a href="#原样输出" class="headerlink" title="原样输出"></a>原样输出</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;literal&#125;
应用文件配置，默认模块：&#123;$Think.config.default_module&#125;&lt;br&gt;
&#123;&#x2F;literal&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在literal标签中的PHP代码不会被解析，视图代码是什么样子，浏览器代码就输出什么样子</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;literal&#125;
&lt;script&gt;
    function test() &#123;
    let $name&#x3D;&#39;test&#39;;
    return &#123;$name&#125;
&#125;
$result&#x3D;test();
console.log($result);
&lt;&#x2F;script&gt;
&#123;&#x2F;literal&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>literal</code>标签还可以用于页面的JS代码外层，确保JS代码中的某些用法和模板引擎不产生混淆</p>
<p>总之，所有可能和内置模板引擎的解析规则冲突的地方都可以使用<code>literal</code>标签处理</p>
<h3 id="内置标签"><a href="#内置标签" class="headerlink" title="内置标签"></a>内置标签</h3><h4 id="资源文件加载"><a href="#资源文件加载" class="headerlink" title="资源文件加载"></a>资源文件加载</h4><p>传统引入外部文件的方式</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text/javascript<span class="token punctuation">'</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/static/js/common.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/css/style.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>在框架中可以简化为</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;load href&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;common.js&quot; &#x2F;&#125;
&#123;load href&#x3D;&quot;&#x2F;static&#x2F;css&#x2F;style.css&quot; &#x2F;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>支持同时加载多个资源文件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;load href&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;common.js,&#x2F;static&#x2F;css&#x2F;style.css&quot; &#x2F;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>提供了两个标签别名</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;js href&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;common.js&quot; &#x2F;&#125;
&#123;css href&#x3D;&quot;&#x2F;static&#x2F;css&#x2F;style.css&quot; &#x2F;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h4 id="循环标签"><a href="#循环标签" class="headerlink" title="循环标签"></a>循环标签</h4><p>控制器内先对模板进行赋值</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function index()&#123;
        $users &#x3D; [
            [
                &#39;name&#39;&#x3D;&gt;&#39;admin&#39;,
                &#39;gender&#39;&#x3D;&gt;&#39;男&#39;,
                &#39;age&#39;&#x3D;&gt;18
            ],
            [
                &#39;name&#39;&#x3D;&gt;&#39;zhangsan&#39;,
                &#39;gender&#39;&#x3D;&gt;&#39;男&#39;,
                &#39;age&#39;&#x3D;&gt;20
            ],
            [
                &#39;name&#39;&#x3D;&gt;&#39;lisi&#39;,
                &#39;gender&#39;&#x3D;&gt;&#39;女&#39;,
                &#39;age&#39;&#x3D;&gt;21
            ]
        ];

        return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$users]);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对应的视图模板</p>
<pre class="line-numbers language-php+html" data-language="php+html"><code class="language-php+html">&lt;table border&#x3D;&quot;1&quot; cellspacing&#x3D;&quot;0&quot;&gt;
    &lt;tr&gt;
        &lt;th&gt;no&lt;&#x2F;th&gt;
        &lt;th&gt;name&lt;&#x2F;th&gt;
        &lt;th&gt;gender&lt;&#x2F;th&gt;
        &lt;th&gt;age&lt;&#x2F;th&gt;
    &lt;&#x2F;tr&gt;
    &#123;volist name&#x3D;&quot;users&quot; id&#x3D;&quot;user&quot;&#125;
    &lt;tr&gt;
        &lt;td&gt;&#123;$i&#125;&lt;&#x2F;td&gt;
        &lt;td&gt;&#123;$user.name&#125;&lt;&#x2F;td&gt;
        &lt;td&gt;
            &#123;$user.gender&#125;
        &lt;&#x2F;td&gt;
        &lt;td&gt;
            &#123;egt name&#x3D;&quot;user.age&quot; value&#x3D;&quot;20&quot;&#125;
                青年
            &#123;else&#x2F;&#125;
                &#123;$user.age&#125;
            &#123;&#x2F;egt&#125;
        &lt;&#x2F;td&gt;
    &lt;&#x2F;tr&gt;
    &#123;&#x2F;volist&#125;
&lt;&#x2F;table&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>volist标签</strong>标签通常用于查询数据集或者二维数组的结果输出</p>
<p><code>Volist</code>标签的<code>name</code>属性表示<strong>模板赋值的变量名称</strong>，因此不可随意在模板文件中改变。<code>id</code>表示<strong>当前的循环变量</strong>，可以随意指定，但确保不要和<code>name</code>属性冲突</p>
<p>可以在volist标签后面设置参数来达到想要的效果</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;支持输出查询结果中的部分数据，例如输出其中的第5～15条记录
&#123;volist name&#x3D;&quot;list&quot; id&#x3D;&quot;vo&quot; offset&#x3D;&quot;5&quot; length&#x3D;&#39;10&#39;&#125;
	&#123;$vo.name&#125;
&#123;&#x2F;volist&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="比较标签"><a href="#比较标签" class="headerlink" title="比较标签"></a>比较标签</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;比较标签 name&#x3D;&quot;变量&quot; value&#x3D;&quot;值&quot;&#125;
内容
&#123;&#x2F;比较标签&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th align="left">标签</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">eq或者 equal</td>
<td align="left">等于</td>
</tr>
<tr>
<td align="left">neq 或者notequal</td>
<td align="left">不等于</td>
</tr>
<tr>
<td align="left">gt</td>
<td align="left">大于</td>
</tr>
<tr>
<td align="left">egt</td>
<td align="left">大于等于</td>
</tr>
<tr>
<td align="left">lt</td>
<td align="left">小于</td>
</tr>
<tr>
<td align="left">elt</td>
<td align="left">小于等于</td>
</tr>
<tr>
<td align="left">heq</td>
<td align="left">恒等于</td>
</tr>
<tr>
<td align="left">nheq</td>
<td align="left">不恒等于</td>
</tr>
</tbody></table>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;td&gt;
    &#x2F;&#x2F;当gender值为男，输出man
	&#123;eq name &#x3D;&quot;user.gender&quot; value&#x3D;&#39;男&#39;&#125;
		man
	&#123;else&#x2F;&#125;
	&#x2F;&#x2F;其他情况输出woman
		woman
	&#123;&#x2F;eq&#125;
&lt;&#x2F;td&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;td&gt;
    &#x2F;&#x2F;当age值&#x3D;20，输出青年，其他情况直接输出该值
    &#123;egt name&#x3D;&quot;user.age&quot; value&#x3D;&quot;20&quot;&#125;
    	青年
    &#123;else&#x2F;&#125;
    	&#123;$user.age&#125;
    &#123;&#x2F;egt&#125;
&lt;&#x2F;td&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="条件判断标签"><a href="#条件判断标签" class="headerlink" title="条件判断标签"></a>条件判断标签</h4><h5 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;switch User.level&#125;
    &#123;case 1&#125;value1&#123;&#x2F;case&#125;
    &#123;case 2&#125;value2&#123;&#x2F;case&#125;
    &#123;default &#x2F;&#125;default
&#123;&#x2F;switch&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>支持函数以及系统变量</p>
<p>对于case属性可以支持多个条件的判断，使用”|”进行分割，例如：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;switch Think.get.type&#125;
    &#123;case gif|png|jpg&#125;图像格式&#123;&#x2F;case&#125;
    &#123;default &#x2F;&#125;其他格式
&#123;&#x2F;switch&#125;
&#x2F;&#x2F;表示如果$_GET[&quot;type&quot;]是gif、png或者jpg的话，就判断为图像格式<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>也可以对case的value属性使用变量，例如：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;switch $User.userId&#125;
    &#123;case $adminId&#125;admin&#123;&#x2F;case&#125;
    &#123;case $memberId&#125;member&#123;&#x2F;case&#125;
&#123;&#x2F;switch&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意：<strong>使用变量方式的情况下，不再支持<code>|</code>分割的多个条件判断用法。</strong></p>
<h5 id="if"><a href="#if" class="headerlink" title="if"></a>if</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;if ( $name &#x3D;&#x3D; 1) OR ( $name &gt; 100) &#125; value1
&#123;elseif $name &#x3D;&#x3D; 2 &#x2F;&#125;value2
&#123;else &#x2F;&#125; value3
&#123;&#x2F;if&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="包含文件"><a href="#包含文件" class="headerlink" title="包含文件"></a>包含文件</h3><p>在当前模板文件中可以使用include标签来引入其他模板文件中的代码</p>
<p>注意：包含的模板文件中不能再使用模板布局或者模板继承</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Controller中的方法 
public function index()&#123;
        $users &#x3D; [
            [
                &#39;name&#39;&#x3D;&gt;&#39;admin&#39;,
                &#39;gender&#39;&#x3D;&gt;&#39;男&#39;,
                &#39;age&#39;&#x3D;&gt;18
            ],
            [
                &#39;name&#39;&#x3D;&gt;&#39;zhangsan&#39;,
                &#39;gender&#39;&#x3D;&gt;&#39;男&#39;,
                &#39;age&#39;&#x3D;&gt;20
            ],
            [
                &#39;name&#39;&#x3D;&gt;&#39;lisi&#39;,
                &#39;gender&#39;&#x3D;&gt;&#39;女&#39;,
                &#39;age&#39;&#x3D;&gt;21
            ]
        ];

        return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$users]);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在对应的控制器的视图文件夹下创建视图文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">//index.html
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们在view文件夹下面创建public文件夹用于存放会被包含的模板文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">//header.html
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>包含文件的操作有三种：</p>
<h4 id="模板表达式"><a href="#模板表达式" class="headerlink" title="模板表达式"></a>模板表达式</h4><p>模版表达式的定义规则为：<strong>模块@控制器/操作</strong></p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;&#x2F;title&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
    &#123;include file&#x3D;&quot;public&#x2F;header&quot;&#125;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这样就能直接将header模板文件中的代码引入到当前模板中</p>
<p><strong>一次可以包含多个模板</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;include file&#x3D;&quot;public&#x2F;header,public&#x2F;menu&quot; &#x2F;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>但是一次包含多个模板会按照顺序将引入的模板渲染到浏览器，可能与我们想要的界面不同，因此比较少用</p>
<p>注意：包含模版文件并不会自动调用控制器的方法，也就是说包含的其他模版文件中的变量赋值需要在当前操作中完成。</p>
<p>若我们创建一个被包含的模板文件，模板文件中为一个待渲染的列表</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">//public/user_list.html
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>no<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>gender<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>age<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
    &#123;volist name="users" id="user"&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&#123;$i&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&#123;$user.name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
            &#123;eq name ="user.gender" value='男'&#125;
            man
            &#123;else/&#125;
            woman
            &#123;/eq&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
            &#123;egt name="user.age" value="20"&#125;
            青年
            &#123;else/&#125;
            &#123;$user.age&#125;
            &#123;/egt&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
    &#123;/volist&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>将文件导入到视图模板</p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;&#x2F;title&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
    &#123;include file&#x3D;&quot;public&#x2F;header&quot;&#125;
    &#123;include file&#x3D;&quot;public&#x2F;user_list&quot;&#125;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此时控制器中的方法会将数据渲染到admin/index.html中</p>
<p>可以理解为仅仅是把被包含的模板文件的那部分代码与include标签的地方相替换</p>
<h4 id="模版文件"><a href="#模版文件" class="headerlink" title="模版文件"></a>模版文件</h4><p>可以直接包含一个模版文件名（包含完整路径）</p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;&#x2F;title&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
    &#123;include file&#x3D;&quot;..&#x2F;application&#x2F;admin&#x2F;view&#x2F;public&#x2F;header.html&quot;&#125;
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="传入参数"><a href="#传入参数" class="headerlink" title="传入参数"></a>传入参数</h4><p>include标签支持在包含文件的同时传入参数</p>
<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&#x2F;&#x2F;header
&lt;header&gt;标题[title]&#123;$title&#125;&lt;&#x2F;header&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>[title]可以在include标签中传入</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;include file&#x3D;&quot;public&#x2F;header&quot; title&#x3D;&quot;中括号&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>{$title}可以在控制器中传入</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function index()&#123;
    $users &#x3D; [
        [
            &#39;name&#39;&#x3D;&gt;&#39;admin&#39;,
            &#39;gender&#39;&#x3D;&gt;&#39;男&#39;,
            &#39;age&#39;&#x3D;&gt;18
        ],
        [
            &#39;name&#39;&#x3D;&gt;&#39;zhangsan&#39;,
            &#39;gender&#39;&#x3D;&gt;&#39;男&#39;,
            &#39;age&#39;&#x3D;&gt;20
        ],
        [
            &#39;name&#39;&#x3D;&gt;&#39;lisi&#39;,
            &#39;gender&#39;&#x3D;&gt;&#39;女&#39;,
            &#39;age&#39;&#x3D;&gt;21
        ]
    ];

    return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$users,&#39;footer&#39;&#x3D;&gt;&#39;footer&#39;,&#39;title&#39;&#x3D;&gt;&#39;大括号&#39;]);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="模板布局"><a href="#模板布局" class="headerlink" title="模板布局"></a>模板布局</h3><p>TP5可以实现模板布局以及布局嵌套的功能</p>
<p>三种布局模板的支持方式：</p>
<p>全局配置方式</p>
<p>模板标签方式</p>
<p>动态方法布局</p>
<h3 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h3><p>是一种更加灵活的模板布局方式，模板继承不同于模板布局，甚至在模板布局的上层。</p>
<p>好比类的继承，模板也可以定义一个基础模板（布局），并且在其中定义相关区块（block），然后继承（extend）该基础模板的子模板就可队基础模板中定义的区块进行重载</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">//admin/view/base.html
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>&#123;block name="title"&#125;标题&#123;/block&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    &#123;block name="style"&#125;&#123;/block&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    &#123;block name="header"&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span>&#123;/block&#125;
    &#123;block name="content"&#125;主要内容&#123;/block&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>2021<span class="token entity named-entity" title="&copy;">&amp;copy;</span>诚毅学院<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>
    &#123;block name="script"&#125;&#123;/block&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们在对应模块下的view文件夹中可以创建一个基础模板，其中有在我们想要的地方定义block块，用name属性做他的标签</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function create()&#123;
        return $this-&gt;fetch();
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在控制器类中指向想要渲染的模板文件</p>
<p>在该子模板文件中可以用extend继承这个基础模板的布局，并且对其重写</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;extend name&#x3D;&quot;base&quot; &#x2F;&#125;
&#123;block name&#x3D;&quot;style&quot;&#125;
&lt;style&gt;
    body&#123;
        background: greenyellow;
    &#125;
&lt;&#x2F;style&gt;
&#123;&#x2F;block&#125;
&#123;block name&#x3D;&quot;header&quot;&#125;&#123;&#x2F;block&#125;
&#123;block name&#x3D;&quot;title&quot;&#125;添加管理员&#123;&#x2F;block&#125;
&#123;block name&#x3D;&quot;content&quot;&#125;&#123;__block__&#125;中间&#123;&#x2F;block&#125;
&#123;block name&#x3D;&quot;script&quot;&#125;
    &lt;script&gt;
        window.onload &#x3D; function () &#123;
            alert(&#39;hello&#39;);
        &#125;
    &lt;&#x2F;script&gt;
&#123;&#x2F;block&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>若在子模板中的block标签中没有传值，则会使该block消失</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;block name&#x3D;&quot;content&quot;&#125;&#123;__block__&#125;中间&#123;&#x2F;block&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>该标签会将基础模板中的内容包含进来</p>
<p>extend标签的用法和include标签一样，也可以加载其他模板（比较少用）</p>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="设计表"><a href="#设计表" class="headerlink" title="设计表"></a>设计表</h3><ul>
<li>表的字符集与排序规则常选择utf8mb4<ul>
<li>与utf8的不同在于，utf8mb4能存储四个字节长度的字而utf8只能存三个字节长度的字，如果在该行中可能需要存表情一类的字符，使用utf8就存不下，只能用utf8bm4</li>
</ul>
</li>
<li>根据数据量大小，主键一般选择int或bigint，自增，非空</li>
<li>用户密码使用MD5加密后长度固定32位，类型可以选择char</li>
<li>年龄在数据库中主要用生日去计算，而不是用一个固定的年龄，类型一般为date，若用datetime，前端input标签中的date会无法输出该日期</li>
</ul>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>通过更改database.php配置文件中的参数可以实现与数据库的连接</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;其中有改动的部分，其他部分可根据需求改动
&lt;?php
return [
    &#x2F;&#x2F; 数据库类型
    &#39;type&#39;            &#x3D;&gt; &#39;mysql&#39;,
    &#x2F;&#x2F; 服务器地址
    &#39;hostname&#39;        &#x3D;&gt; &#39;127.0.0.1&#39;,
    &#x2F;&#x2F; 数据库名
    &#39;database&#39;        &#x3D;&gt; &#39;tp5&#39;,
    &#x2F;&#x2F; 用户名
    &#39;username&#39;        &#x3D;&gt; &#39;root&#39;,
    &#x2F;&#x2F; 密码
    &#39;password&#39;        &#x3D;&gt; &#39;123456&#39;,
    &#x2F;&#x2F; 端口
    &#39;hostport&#39;        &#x3D;&gt; &#39;3306&#39;,
    &#x2F;&#x2F; 数据库编码默认采用utf8
    &#39;charset&#39;         &#x3D;&gt; &#39;utf8mb4&#39;,
    &#x2F;&#x2F; 数据库表前缀
    &#39;prefix&#39;          &#x3D;&gt; &#39;php_&#39;,
    &#x2F;&#x2F; 数据库调试模式
    &#39;debug&#39;           &#x3D;&gt; true,
    &#x2F;&#x2F; 是否需要断线重连
    &#39;break_reconnect&#39; &#x3D;&gt; true,
];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><h4 id="query"><a href="#query" class="headerlink" title="query()"></a>query()</h4><p>原生查询，参数为sql语句，直接执行sql语句进行查询</p>
<h4 id="Db-table"><a href="#Db-table" class="headerlink" title="Db::table()"></a>Db::table()</h4><p>指定一个表，参数为表名，需要继承think\Db基类</p>
<h4 id="DB-name"><a href="#DB-name" class="headerlink" title="DB::name()"></a>DB::name()</h4><p>若在datebase.php中有配置数据表前缀，表名可以省略前缀</p>
<h4 id="db"><a href="#db" class="headerlink" title="db()"></a>db()</h4><p>助手函数，DB::name()的进一步简化，与上面俩个的效果一样，可以更方便的查询</p>
<h4 id="find"><a href="#find" class="headerlink" title="find()"></a>find()</h4><p>查询一条数据，相当于limit 1，若查询结果不存在，返回null</p>
<h4 id="select"><a href="#select" class="headerlink" title="select()"></a>select()</h4><p>查询所有数据，若查询结果不存在，返回空数组</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function index()&#123;
    &#x2F;&#x2F;$result &#x3D; Db::query(&#39;select * from php_user&#39;);
    &#x2F;&#x2F;$result &#x3D; Db::table(&#39;php_user&#39;)-&gt;find();
    &#x2F;&#x2F;$result &#x3D; db(&#39;user&#39;)-&gt;select();
    $result &#x3D; Db::table(&#39;php_user&#39;)-&gt;select();
    return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$result]);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--admin/view/public/user_list.html--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">cellspacing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>no<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>gender<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>birth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>opration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
    &#123;volist name="users" id="user"&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&#123;$i&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&#123;$user.name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
            &#123;$user.gender&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
            &#123;$user.birth&#125;
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>reset_password<span class="token punctuation">'</span>,[<span class="token punctuation">'</span>id<span class="token punctuation">'</span>=>$user.id])&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>重置密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>update_user<span class="token punctuation">'</span>,[<span class="token punctuation">'</span>id<span class="token punctuation">'</span>=>$user.id])&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>delete_user<span class="token punctuation">'</span>,[<span class="token punctuation">'</span>id<span class="token punctuation">'</span>=>$user.id])&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
    &#123;/volist&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&#x2F;&#x2F;index.html
&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
    &lt;title&gt;信息列表&lt;&#x2F;title&gt;
    &lt;style&gt;
        a&#123;
            text-decoration:none;
        &#125;
    &lt;&#x2F;style&gt;

&lt;&#x2F;head&gt;
&lt;body&gt;
&lt;button&gt;添加用户&lt;&#x2F;button&gt;&lt;a href&#x3D;&quot;&#123;:url(&#39;tologin&#39;)&#125;&quot;&gt;注销&lt;&#x2F;a&gt;
    &#123;include file&#x3D;&quot;..&#x2F;application&#x2F;admin&#x2F;view&#x2F;public&#x2F;header.html&quot; title&#x3D;&quot;header&quot;&#125;
    &#123;include file&#x3D;&quot;public&#x2F;user_list&quot;&#125;
    &#123;include file&#x3D;&quot;public&#x2F;footer&quot;&#125;
&lt;&#x2F;body&gt;
&lt;script&gt;
    window.onload&#x3D;function () &#123;
        var btn &#x3D; document.querySelectorAll(&#39;button&#39;);
        btn[0].onclick &#x3D; function () &#123;
            window.location&#x3D;&quot;&#123;:url(&#39;create_user&#39;)&#125;&quot;
        &#125;
    &#125;
&lt;&#x2F;script&gt;
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在href中写**{:url(‘tologin’)}**会自动解析到当前页面所属的控制器类中的另一个方法</p>
<h4 id="where"><a href="#where" class="headerlink" title="where()"></a>where()</h4><p>指定查询的条件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;查询id与传入的id相同的一条信息
$user &#x3D; Db::table(&#39;php_user&#39;)-&gt;where(&#39;id&#39;,$id)-&gt;find();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="value"><a href="#value" class="headerlink" title="value()"></a>value()</h4><p>查询某个字段的值</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 返回id&#x3D;1的name的值
&#x2F;&#x2F;select name from php_user where id&#x3D;1;
Db::table(&#39;php_user&#39;)-&gt;where(&#39;id&#39;,1)-&gt;value(&#39;name&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="column"><a href="#column" class="headerlink" title="column()"></a>column()</h4><p>查询某一列的值</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 查询status&#x3D;1的所name的值
Db::table(&#39;php_user&#39;)-&gt;where(&#39;status&#39;,1)-&gt;column(&#39;name&#39;);
&#x2F;&#x2F; 指定id字段的值作为索引
Db::table(&#39;php_user&#39;)-&gt;where(&#39;status&#39;,1)-&gt;column(&#39;name&#39;,&#39;id&#39;);
&#x2F;&#x2F; 指定id字段的值作为索引 返回所有数据
Db::table(&#39;php_user&#39;)-&gt;where(&#39;status&#39;,1)-&gt;column(&#39;*&#39;,&#39;id&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>login<span class="token punctuation">'</span>)&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">function toLogin()&#123;
    &#x2F;&#x2F;跳转到登录页面
    return $this-&gt;fetch(&#39;login&#39;);
&#125;

function login()&#123;
    &#x2F;&#x2F;获取前端输入的用户名密码
    $name &#x3D; input(&#39;name&#39;);
    &#x2F;&#x2F;密码使用MD5加密
    $password &#x3D; md5(input(&#39;password&#39;));
    &#x2F;&#x2F;若输入的用户名密码能与数据库匹配到，则跳转到主页面
    $result &#x3D; Db::table(&#39;php_user&#39;)-&gt;where([&#39;name&#39;&#x3D;&gt;$name,&#39;password&#39;&#x3D;&gt;$password])-&gt;find();
    if ($result!&#x3D;null)&#123;
        $this-&gt;success(&#39;登陆成功&#39;,&#39;index&#39;);
    &#125;else&#123;
        &#x2F;&#x2F;error不加第二个参数会保留在当前页面
        $this-&gt;error(&#39;登录失败&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><h4 id="insert"><a href="#insert" class="headerlink" title="insert()"></a>insert()</h4><p>向数据库提交数据</p>
<h4 id="strict"><a href="#strict" class="headerlink" title="strict()"></a>strict()</h4><p>参数为false时，若要插入的字段不存在，也能插入成功</p>
<h4 id="insertGetId"><a href="#insertGetId" class="headerlink" title="insertGetId()"></a>insertGetId()</h4><p>添加数据后返回新增数据的自增主键</p>
<h4 id="insertAll"><a href="#insertAll" class="headerlink" title="insertAll()"></a>insertAll()</h4><p>insertAll 方法添加数据成功返回添加成功的条数，很少用</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--在index中添加用户的按钮--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>添加用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        btn<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            window<span class="token punctuation">.</span>location<span class="token operator">=</span><span class="token string">"&#123;:url('create_user')&#125;"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--admin/view/admin/create_user.html--></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>添加用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>save_user<span class="token punctuation">'</span>)&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!--伪装请求方法--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PUT<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
        性别：
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>男<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token punctuation">></span></span>男
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>女<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>女
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>出生日期：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>birth<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>保存<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">function create_user()&#123;
    &#x2F;&#x2F;跳转到添加用户的界面
    return $this-&gt;fetch(&#39;&#39;);
&#125;

&#x2F;&#x2F;保存用户信息
function save_user()&#123;
    &#x2F;&#x2F;获取表单输入的所有信息
    $data&#x3D;input();
    &#x2F;&#x2F;保存密码前先转为MD5格式
    $data[&#39;password&#39;]&#x3D;md5($data[&#39;password&#39;]);
    Db::name(&#39;php_user&#39;)-&gt;strict(false)-&gt;insertGetId($data);
    return $this-&gt;success(&#39;添加成功&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><h4 id="update"><a href="#update" class="headerlink" title="update()"></a>update()</h4><p>修改数据库中的数据，可在后面拼接方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Db::name(&#39;user&#39;)
    -&gt;where(&#39;id&#39;, 1)
    -&gt;update([&#39;name&#39; &#x3D;&gt; &#39;thinkphp&#39;]);
&#x2F;&#x2F;UPDATE &#39;think_user&#39;  SET &#39;name&#39;&#x3D;&#39;thinkphp&#39;  WHERE  &#39;id&#39; &#x3D; 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">Db::name(&#39;user&#39;)
    -&gt;where(&#39;id&#39;,1)
    -&gt;inc(&#39;read_time&#39;)&#x2F;&#x2F;read+1
    -&gt;dec(&#39;score&#39;,3)&#x2F;&#x2F;score-3
    -&gt;exp(&#39;name&#39;,&#39;UPPER(name)&#39;)&#x2F;&#x2F;name次幂
    -&gt;update();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--update_user--></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>修改用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>edit_user<span class="token punctuation">'</span>)&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;$user.id&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PUT<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;$user.name&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
        性别：
        &lt;input type="radio" name="gender" value="男" &#123;if $user['gender']=='男'&#125;checked&#123;/if&#125;>男
        &lt;input type="radio" name="gender" value="女" &#123;if $user['gender']=='女'&#125;checked&#123;/if&#125;>女
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>出生日期：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>birth<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;$user.birth&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>保存<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;要修改数据时应该先获取要修改的数据对象，并且传到视图中
function update_user($id)&#123;
    $user &#x3D; Db::table(&#39;php_user&#39;)-&gt;where(&#39;id&#39;,$id)-&gt;find();
    return $this-&gt;fetch(&#39;&#39;,[&#39;user&#39;&#x3D;&gt;$user]);
&#125;

&#x2F;&#x2F;获取表单中的所有信息进行修改
function edit_user($id)&#123;
    dump(input());
    Db::table(&#39;php_user&#39;)-&gt;where(&#39;id&#39;,$id)-&gt;update(input());
    return $this-&gt;success(&#39;修改成功&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><h4 id="delete"><a href="#delete" class="headerlink" title="delete()"></a>delete()</h4><p>传入参数为要删除的数据的主键</p>
<p>当参数为true时，无条件删除所有数据</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Db::name(&#39;user&#39;)-&gt;delete(true);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 根据主键删除
Db::table(&#39;think_user&#39;)-&gt;delete(1);
&#x2F;&#x2F; 条件删除    
Db::table(&#39;think_user&#39;)-&gt;where(&#39;id&#39;,1)-&gt;delete();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="物理删除"><a href="#物理删除" class="headerlink" title="物理删除"></a>物理删除</h4><p>直接将数据从磁盘上删除，再也找不到</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function delete_user($id)&#123;
    $result&#x3D;Db::table(&#39;php_user&#39;)-&gt;where(&#39;id&#39;,$id)-&gt;delete();
    return $this-&gt;success($result&gt;0?&#39;删除成功&#39;:&#39;删除失败&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h4><p>软删除，将数据删除，但是还是保存在磁盘上，只是给了一个独立的字段记录它是否被删除</p>
<h5 id="useSoftDelete"><a href="#useSoftDelete" class="headerlink" title="useSoftDelete()"></a>useSoftDelete()</h5><p>将第一个参数的值改成第二个参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function delete_user($id)&#123;
    $result&#x3D;Db::table(&#39;php_user&#39;)-&gt;useSoftDelete(&#39;deleted&#39;,1)-&gt;delete($id);
    return $this-&gt;success($result&gt;0?&#39;删除成功&#39;:&#39;删除失败&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>同时记得将查询操作中加上一个条件，将已经软删除的数据排除出去</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function index()&#123;
    $result &#x3D; Db::table(&#39;php_user&#39;)-&gt;where(&#39;deleted&#39;,0)-&gt;select();
    return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$result]);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>也可以用删除的时间当作软删除的记录</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 软删除数据 使用delete_time字段标记删除
Db::name(&#39;user&#39;)
	-&gt;where(&#39;id&#39;, 1)
	-&gt;useSoftDelete(&#39;delete_time&#39;,time())
    -&gt;delete();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="查询表达式"><a href="#查询表达式" class="headerlink" title="查询表达式"></a>查询表达式</h3><p>查询表达式支持大部分的SQL查询语法</p>
<h4 id="where-1"><a href="#where-1" class="headerlink" title="where()"></a>where()</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">where(&#39;字段名&#39;,&#39;表达式&#39;,&#39;查询条件&#39;);
whereOr(&#39;字段名&#39;,&#39;表达式&#39;,&#39;查询条件&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th align="left">表达式</th>
<th align="left">含义</th>
<th align="left">快捷查询方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">=</td>
<td align="left">等于</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;&gt;</td>
<td align="left">不等于</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">大于</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&gt;=</td>
<td align="left">大于等于</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;=</td>
<td align="left">小于等于</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">[NOT] LIKE</td>
<td align="left">模糊查询</td>
<td align="left"><code>whereLike/whereNotLike</code></td>
</tr>
<tr>
<td align="left">[NOT] BETWEEN</td>
<td align="left">（不在）区间查询</td>
<td align="left"><code>whereBetween/whereNotBetween</code></td>
</tr>
<tr>
<td align="left">[NOT] IN</td>
<td align="left">（不在）IN 查询</td>
<td align="left"><code>whereIn/whereNotIn</code></td>
</tr>
<tr>
<td align="left">[NOT] NULL</td>
<td align="left">查询字段是否（不）是NULL</td>
<td align="left"><code>whereNull/whereNotNull</code></td>
</tr>
<tr>
<td align="left">[NOT] EXISTS</td>
<td align="left">EXISTS查询</td>
<td align="left"><code>whereExists/whereNotExists</code></td>
</tr>
<tr>
<td align="left">[NOT] REGEXP</td>
<td align="left">正则（不）匹配查询（仅支持Mysql）</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">[NOT] BETWEEM TIME</td>
<td align="left">时间区间比较</td>
<td align="left">whereBetweenTime</td>
</tr>
<tr>
<td align="left">&gt; TIME</td>
<td align="left">大于某个时间</td>
<td align="left"><code>whereTime</code></td>
</tr>
<tr>
<td align="left">&lt; TIME</td>
<td align="left">小于某个时间</td>
<td align="left"><code>whereTime</code></td>
</tr>
<tr>
<td align="left">&gt;= TIME</td>
<td align="left">大于等于某个时间</td>
<td align="left"><code>whereTime</code></td>
</tr>
<tr>
<td align="left">&lt;= TIME</td>
<td align="left">小于等于某个时间</td>
<td align="left"><code>whereTime</code></td>
</tr>
<tr>
<td align="left">EXP</td>
<td align="left">表达式查询，支持SQL语法</td>
<td align="left"><code>whereExp</code></td>
</tr>
</tbody></table>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Db::name(&#39;user&#39;)-&gt;where(&#39;id&#39;,&#39;&lt;&gt;&#39;,100)-&gt;select();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>若只有字段名与查询条件，则默认中间的表达式为 = </p>
<h3 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h3><h4 id="快捷查询"><a href="#快捷查询" class="headerlink" title="快捷查询"></a>快捷查询</h4><p>快捷查询方式是<strong>一种多字段相同查询条件</strong>的简化写法，可以进一步简化查询条件的写法，在多个字段之间用<code>|</code>分割表示<code>OR</code>查询，用<code>&amp;</code>分割表示<code>AND</code>查询</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function login()&#123;
    $name &#x3D; input(&#39;name&#39;);
    $password &#x3D; md5(input(&#39;password&#39;));
    &#x2F;&#x2F;只能支持用户名与密码登录
    &#x2F;*$result &#x3D; Db::table(&#39;php_user&#39;)
    	-&gt;where([&#39;name&#39;&#x3D;&gt;$name,&#39;password&#39;&#x3D;&gt;$password])
    	-&gt;find();*&#x2F;
    &#x2F;&#x2F;能支持用户名|手机号与密码登录
    $result &#x3D; Db::table(&#39;php_user&#39;)
        -&gt;where(&#39;name|phone&#39;,$name)
        -&gt;where(&#39;password&#39;,$password)
        -&gt;find();
    if ($result!&#x3D;null)&#123;
        $this-&gt;success(&#39;登陆成功&#39;,&#39;index&#39;);
    &#125;else&#123;
        $this-&gt;error(&#39;登录失败&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="链式操作"><a href="#链式操作" class="headerlink" title="链式操作"></a>链式操作</h3><p>数据库提供的链式操作方法，可以有效的提高数据存取的代码清晰度和开发效率，并且支持所有的CURD操作（原生查询不支持链式操作）。</p>
<p>以分页查询为例子</p>
<p><strong>page()</strong></p>
<p>第一个参数为页数，第二个参数为每页体现的数据条数</p>
<p>可以将第一个参数设置为变量，通过前端改变此变量的方式来实现分页查询</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function index()&#123;
    $result &#x3D; Db::table(&#39;php_user&#39;)
        -&gt;where(&#39;deleted&#39;,0)
        -&gt;page(2,3)
        -&gt;select();
    return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$result]);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>我们可以使用模型来进行增删改查以及一些聚合操作</p>
<p>在application下创建common\model目录用于存放模型文件</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>定义User类，模型的类名应该为数据表去除前缀，首字母大写，并且采用驼峰命名法</p>
<table>
<thead>
<tr>
<th align="left">型名</th>
<th align="left">约定对应数据表（假设数据库的前缀定义是 <code>think_</code>）</th>
</tr>
</thead>
<tbody><tr>
<td align="left">User</td>
<td align="left">think_user</td>
</tr>
<tr>
<td align="left">UserType</td>
<td align="left">think_user_type</td>
</tr>
</tbody></table>
<p>模型自动对应的数据表名称都是遵循<strong>小写+下划线</strong>规范，如果你的表名有大写的情况，必须通过设置模型的table属性。</p>
<p>定义模型时应该继承think\Model类</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\common\model;

use think\Model;

class User extends Model
&#123;
    &#x2F;&#x2F;一般数据表主键为id时可不写，若不为id需要加上此定义
	protected $pk &#x3D; &#39;uid&#39;;
    &#x2F;&#x2F;若想连接指定的数据库
	&#x2F;&#x2F; 设置当前模型对应的完整数据表名称
    protected $table &#x3D; &#39;think_user&#39;;
    &#x2F;&#x2F; 设置当前模型的数据库连接
    protected $connection &#x3D; &#39;db_config&#39;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以登录功能为例</p>
<p>在我们控制器中继承我们刚刚定义好的模型</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">……
&#x2F;&#x2F;采用别名的方法更加易于使用
use app\common\model\User as UserModel;
……
class Admin &#123;
……
  function login()&#123;
        &#x2F;&#x2F;能支持用户名|手机号与密码登录
        $name &#x3D; input(&#39;name&#39;);
        $password &#x3D; input(&#39;password&#39;);
        $result &#x3D; UserModel::where(&#39;name|phone&#39;,$name)
            -&gt;where(&#39;password&#39;,$password)
            -&gt;find();
        if ($result!&#x3D;null)&#123;
            $this-&gt;success(&#39;登陆成功&#39;,&#39;index&#39;);
        &#125;else&#123;
            $this-&gt;error(&#39;登录失败&#39;);
        &#125;
    &#125;  
……
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="编写Service"><a href="#编写Service" class="headerlink" title="编写Service"></a>编写Service</h4><p>为了提高代码的可重用性，我们原则上应该编写Service类</p>
<p>创建common\serviece用于存放Service的文件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\common\service;
&#x2F;&#x2F;引入模型文件
use app\common\model\User as UserModel;
class User
&#123;
    &#x2F;**
     * 用户登录
     * @param $account
     * 账号
     * @param $password
     * 密码
     * @return
     * bool true:成功 false:失败
     *&#x2F;
    function login($account,$password)&#123;
        &#x2F;&#x2F;有必要的话账号加密也可以在Service中完成
		&#x2F;&#x2F;$password &#x3D; md5($password);
        $result &#x3D; UserModel::where(&#39;name|phone&#39;,$account)
            -&gt;where(&#39;password&#39;,$password)
            -&gt;find();
        return $result!&#x3D;null;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在控制器中就可以引入Service</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\admin\controller;
……
use app\common\service\User as UserService;

class Admin&#123;
……
    function login()&#123;
        &#x2F;&#x2F;能支持用户名|手机号与密码登录
        $name &#x3D; input(&#39;name&#39;);
        $password &#x3D; input(&#39;password&#39;);
        $result &#x3D; (new UserService())-&gt;login($name,$password);
        if ($result)&#123;
            $this-&gt;success(&#39;登陆成功&#39;,&#39;index&#39;);
        &#125;else&#123;
            $this-&gt;error(&#39;登录失败&#39;);
        &#125;
    &#125;
……
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="数据调用关系"><a href="#数据调用关系" class="headerlink" title="数据调用关系"></a>数据调用关系</h3><p>—-&gt;箭头所指方向表示调用该模块</p>
<p>视图（view）&lt;—-&gt;控制器（Controller）—-&gt;Service—-&gt;模型（model）—-&gt;数据库（database）</p>
<h3 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h3><p>原理：在Service中，通过对模型的方法的调用对数据库进行操作；在控制器中，对Service进行实例化，并且调用其中的方法</p>
<p>注意：在Service中的操作写法与直接在Controller中的操作写法不一样，因为在Service中是对<strong>模型内的方法</strong>进行调用；而在Controller中，是对<strong>DB类中的方法</strong>进行调用，所继承的类不同，所调用的方法也不同，详见手册</p>
<p>推荐方式为静态方法，静态方法返回值都是<strong>一个实例</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\common\service;
use app\common\model\User as UserModel;
class User
&#123;
    &#x2F;**
     * 用户登录
     * @param $account 账号
     * @param $password 密码
     * @return bool true:成功 false:失败
     *&#x2F;
    function login($account,$password)&#123;
        &#x2F;&#x2F;$password &#x3D; md5($password);
        $result &#x3D; UserModel::where(&#39;name|phone&#39;,$account)
            -&gt;where(&#39;password&#39;,$password)
            -&gt;find();
        return $result!&#x3D;null;
    &#125;

    &#x2F;**
     * 查询所有数据（包括已删除）
     * @return UserModel[]|\think\Collection
     *&#x2F;
    function getAllUsers()&#123;
        return UserModel::select();
    &#125;

    &#x2F;**
     * 查询所用数据（不包括已删除）
     * @return UserModel[]|\think\Collection
     * 返回有效数据
     *&#x2F;
    function getValidUsers()&#123;
        return UserModel::where(&#39;deleted&#39;,0)-&gt;select();
    &#125;

    &#x2F;**
     * 查询指定数据
     * @param $id 要查找的id
     * @return UserModel
     *&#x2F;

    function findOne($id)&#123;
        return UserModel::get($id);
    &#125;

    &#x2F;**
     * 更新数据
     * @param $id 要修改的id
     * @param $data 修改后的数据
     * @return UserModel
     *&#x2F;
    function edit($data)&#123;
        UserModel::update($data);
    &#125;

    &#x2F;**
     * 新增数据
     * @param $data 要新增的数据
     * @return int|string
     *&#x2F;
    function create($data)&#123;
        &#x2F;&#x2F;根据实际情况选择是否要将密码进行MD5加密
        &#x2F;&#x2F;$data[&#39;password&#39;]&#x3D;md5($data[&#39;password&#39;]);
        UserModel::create($data);
    &#125;

    &#x2F;**
     * 删除数据
     * @param $id 要删除的id
     * @return bool 用于判断是否删除成功
     * @throws \Exception
     *&#x2F;
    function delete($id)&#123;
        return UserModel::useSoftDelete(&#39;deleted&#39;,1)-&gt;delete($id);
    &#125;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\admin\controller;

use think\Controller;
use think\Db;
use think\facade\View;
use app\common\service\User as UserService;

class Admin extends Controller
&#123;
    function toLogin()&#123;
        return $this-&gt;fetch(&#39;login&#39;);
    &#125;

    function login()&#123;
        &#x2F;&#x2F;能支持用户名|手机号与密码登录
        $name &#x3D; input(&#39;name&#39;);
        $password &#x3D; input(&#39;password&#39;);
        $result &#x3D; (new UserService())-&gt;login($name,$password);
        if ($result)&#123;
            $this-&gt;success(&#39;登陆成功&#39;,&#39;index&#39;);
        &#125;else&#123;
            $this-&gt;error(&#39;登录失败&#39;);
        &#125;
    &#125;
    
    public function index()&#123;
        $result &#x3D; (new UserService())-&gt;getValidUsers();
        return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$result,&#39;footer&#39;&#x3D;&gt;&#39;footer&#39;,&#39;title&#39;&#x3D;&gt;&#39;大括号&#39;]);
    &#125;

    function save_user()&#123;
        $data&#x3D;input();
        (new UserService())-&gt;create($data);
        return $this-&gt;success(&#39;添加成功&#39;,url(&#39;index&#39;));
    &#125;

    function create_user()&#123;
        return $this-&gt;fetch(&#39;&#39;);
    &#125;

    function update_user($id)&#123;
        $user &#x3D; (new UserService())-&gt;findOne($id);
        return $this-&gt;fetch(&#39;&#39;,[&#39;user&#39;&#x3D;&gt;$user]);
    &#125;

    function edit_user()&#123;
        (new UserService())-&gt;edit(input());
        return $this-&gt;success(&#39;修改成功&#39;,url(&#39;index&#39;));
    &#125;

    function delete_user($id)&#123;
        $result&#x3D;(new UserService())-&gt;delete($id);
        return $this-&gt;success($result&gt;0?&#39;删除成功&#39;:&#39;删除失败&#39;,url(&#39;index&#39;));
    &#125;

    function reset_password($id)&#123;
        $password &#x3D; &#39;&#39;;
        Db::table(&#39;php_user&#39;)-&gt;where(&#39;id&#39;,$id)-&gt;update([&#39;password&#39;&#x3D;&gt;$password]);
        return $this-&gt;success(&#39;重置密码成功&#39;,url(&#39;index&#39;));
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="软删除"><a href="#软删除" class="headerlink" title="软删除"></a>软删除</h3><p>软删除的原理是在数据库加上一个字段，通过修改此标识字段来标记此字段是否被删除</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Service传统使用DB类的写法
&#x2F;**
     * 删除数据
     * @param $id 要删除的id
     * @return bool 用于判断是否删除成功
     * @throws \Exception
     *&#x2F;
function delete($id)&#123;
    return UserModel::useSoftDelete(&#39;deleted&#39;,1)-&gt;delete($id);
&#125;
&#x2F;&#x2F;Controller中
function delete_user($id)&#123;
    $result&#x3D;(new UserService())-&gt;delete($id);
    return $this-&gt;success($result&gt;0?&#39;删除成功&#39;:&#39;删除失败&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Service通过修改标识字段的写法
function deleteUser($id)&#123;
    return UserModel::update([&#39;id&#39;&#x3D;&gt;$id,&#39;deleted&#39;&#x3D;&gt;1]);
&#125;

&#x2F;&#x2F;Controller中
&#x2F;&#x2F;因为在Service中调用的是静态方法，返回的是一个实例，所以我们可以直接判断实例内的属性是否为1来判断是否软删除成功
function delete_user($id)&#123;
        $result&#x3D;(new UserService())-&gt;deleteUser($id);
        return $this-&gt;success($result-&gt;deleted&#x3D;&#x3D;&#x3D;1?&#39;删除成功&#39;:&#39;删除失败&#39;,url(&#39;index&#39;));
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们可以用框架进行软删除，在model中使用SoftDelete的trait，将标识$deleteTime定义为我们数据表中的删除时间的字段，类型为int，长度为11</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;通过框架进行的软删除
&#x2F;&#x2F;Model
class User extends Model
&#123;
    use SoftDelete;
    protected $deleteTime &#x3D; &#39;delete_time&#39;;
&#125;

&#x2F;&#x2F;Service
function sofeDelete($id)&#123;
    return UserModel::destroy($id);
    &#x2F;&#x2F;若要真实删除则传参改为destroy($id,true)
&#125;

&#x2F;&#x2F;Controller
function delete_user($id)&#123;
    $result&#x3D;(new UserService())-&gt;sofeDelete($id);
    return $this-&gt;success($result&gt;0?&#39;删除成功&#39;:&#39;删除失败&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用这种方式进行软删除时，再使用模型去查询数据会自动过滤已经软删除了的方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Service
&#x2F;&#x2F;此时已经不会显示已经软删除的信息，无需再使用where去指定
function getAllUsers()&#123;
    &#x2F;&#x2F;使用模板的方式进行软删除前
    &#x2F;&#x2F;return UserModel::where(&#39;deleted&#39;,0)-&gt;select();
    &#x2F;&#x2F;&#x2F;&#x2F;使用模板的方式进行软删除后
    return UserModel::select();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果要查看软删除了的数据可以使用</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Service
function getValidUsers()&#123;
    return UserModel::withTrashed()-&gt;select();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>withTrashed</td>
<td>获取包含软删除的数据</td>
</tr>
<tr>
<td>onlyTrashed</td>
<td>仅获取软删除的数据</td>
</tr>
<tr>
<td>restore</td>
<td>恢复被软删除的数据</td>
</tr>
</tbody></table>
<h3 id="获取器"><a href="#获取器" class="headerlink" title="获取器"></a>获取器</h3><p>对模型实例的原始数据做出自动处理，不改变数据库内的数据</p>
<p>也就是说通过获取器处理后，对于PHP框架来说，数据库中的数据内容为在模型中处理过的数据</p>
<p>命名规范为：</p>
<p>getFileNameAttr</p>
<p>FileName为数据表字段的驼峰转换</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function getGenderAttr($val)&#123;
    $data&#x3D;[&#39;男&#39;&#x3D;&gt;&#39;男士&#39;,&#39;女&#39;&#x3D;&gt;&#39;女士&#39;];
    return $data[$val];
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>设置完改获取器后对于框架来说，数据库中值为男变成了男士，女变成了女士，在视图调用的时候也需要进行修改</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;input type&#x3D;&quot;radio&quot; name&#x3D;&quot;gender&quot; value&#x3D;&quot;男&quot; &#123;if $user.gender&#x3D;&#x3D;&#39;男士&#39;&#125;checked&#123;&#x2F;if&#125;&gt;男
    &lt;input type&#x3D;&quot;radio&quot; name&#x3D;&quot;gender&quot; value&#x3D;&quot;女&quot; &#123;if $user.gender&#x3D;&#x3D;&#39;女士&#39;&#125;checked&#123;&#x2F;if&#125;&gt;女<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="动态获取器"><a href="#动态获取器" class="headerlink" title="动态获取器"></a>动态获取器</h4><p>使用动态获取器，无需在模型类中定义获取器方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;定义动态获取器，在查询数据时将name字段中的英文全部转为大写
function getValidUsers()&#123;
    return UserModel::withAttr(&#39;name&#39;,function ($val,$data)&#123;
        return strtoupper($val);
    &#125;)-&gt;select();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="修改器"><a href="#修改器" class="headerlink" title="修改器"></a>修改器</h3><p>和获取器相反，修改器的主要作用是对模型设置的数据对象值进行处理</p>
<p>命名规范为：</p>
<p>setFileNameAttr</p>
<p>FileName为数据表字段的驼峰转换</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;定义动态修改器，在前端页面传入name字段的数据时将英文全部转为大写
&#x2F;**
  * @param $val 数据表中gender字段的数据
  * @return string
  *&#x2F;
function getGenderAttr($val)&#123;
    $data&#x3D;[&#39;男&#39;&#x3D;&gt;&#39;男士&#39;,&#39;女&#39;&#x3D;&gt;&#39;女士&#39;];
    return $data[$val];
&#125;

&#x2F;**
  * @param $val delete_time字段的数据
  * @param $data 表中所有的数据
  * @return string
  *&#x2F;
function getDeleteTimeAttr($val,$data)&#123;
    dump($val);
    dump($data);
    return $data[&#39;delete_time&#39;]?&#39;无效&#39;:&#39;有效&#39;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="数据自动完成"><a href="#数据自动完成" class="headerlink" title="数据自动完成"></a>数据自动完成</h3><p>指不需要手动赋值的情况下对字段的值进行处理后写入数据库</p>
<p>系统支持<strong>auto</strong>、<strong>insert</strong>、<strong>update</strong>三个属性，分别在写入、新增和更新时进行字段的自动完成机制，<strong>auto</strong>属性自动完成包含新增和更新操作</p>
<p>例如我们要在新建用户时获取该用户的ip</p>
<p>先在数据库加上ip字段，类型为varchar</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Model
&#x2F;&#x2F;在模型中定义ip字段
protected $auto &#x3D; [&#39;ip&#39;];

&#x2F;&#x2F;自动写入ip地址
function setIpAttr()&#123;
    return request()-&gt;ip();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h4><p>系统支持自动写入创建和更新的时间戳（默认关闭），有两种方法配置支持：</p>
<h5 id="全局开启"><a href="#全局开启" class="headerlink" title="全局开启"></a>全局开启</h5><p>在database.php配置文件中</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 开启自动写入时间戳字段
&#39;auto_timestamp&#39; &#x3D;&gt; true,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="模型开启"><a href="#模型开启" class="headerlink" title="模型开启"></a>模型开启</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php">protected $autoWriteTimestamp &#x3D; true;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>也可以在database.php中全局开启，之后在不需要自动写入时间戳的模型类中单独关闭</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">protected $autoWriteTimestamp &#x3D; false;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置开启时会自动写入create_time和update_time两个字段的值，默认为整形（int），所以我们需要在数据库中创建对应的字段</p>
<p>若我们的时间字段不是int类型，我们可以指定他自动写入的类型</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 开启自动写入时间戳字段
&#39;auto_timestamp&#39; &#x3D;&gt; &#39;datetime&#39;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">protected $autoWriteTimestamp &#x3D; &#39;datetime&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注意：更改自动写入时间戳字段后，使用模型基类Model进行的软删除中的date_time自动写入的数据类型也会变成datetime，数据库中也需要进行相对应的更改！</p>
<h5 id="自定义时间戳字段名"><a href="#自定义时间戳字段名" class="headerlink" title="自定义时间戳字段名"></a>自定义时间戳字段名</h5><p>当数据库中的字段名不为create_time和update_time时，我们可以在模型中对这两个字段名进行自定义</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 定义时间戳字段名
protected $createTime &#x3D; &#39;create_at&#39;;
protected $updateTime &#x3D; &#39;update_at&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果只需要写入其中一个时间戳，我们可以单独关闭某个字段</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 关闭自动写入update_time字段
protected $updateTime &#x3D; false;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h3 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h3><p>通过模型关联操作把数据表的关联关系对象化，解决大部分常用的关联场景，封装的关联操作比起常规的数据库操作更加智能高效。</p>
<h4 id="一对一关联"><a href="#一对一关联" class="headerlink" title="一对一关联"></a>一对一关联</h4><p>一个用户对应一个地址</p>
<p>此时用户表php_user有一个拓展表php_user_extend，在TP5中也为这个表创建一个UserExtend的Model</p>
<p>拓展表中记录了用户所处的省市区的信息，以user_id作为外键与php_user关联，但在php_user_extend表中没有创建外键关联</p>
<p>可以在User的model里为这两个表创建关联</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Model
function extend2()&#123;
    &#x2F;&#x2F;一个用户有一个信息对应的拓展表
    return $this-&gt;hasOne(&#39;UserExtend&#39;,&#39;user_id&#39;,&#39;id&#39;);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>hasOne</code>方法的参数包括：</p>
<p><strong>hasOne(‘关联模型’,’外键’,’主键’);</strong></p>
<p>除了关联模型外，其它参数都是可选。</p>
<ul>
<li><strong>关联模型</strong>（必须）：关联的模型名或者类名</li>
<li><strong>外键</strong>：默认的外键规则是当前模型名（不含命名空间，下同）+<code>_id</code> ，例如<code>user_id</code></li>
<li><strong>主键</strong>：当前模型主键，默认会自动获取也可以指定传入</li>
</ul>
<p>此时就可以在控制器中调用模型中的方法去查询拓展表的数据</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function test()&#123;
    &#x2F;&#x2F;1为id为1的数据
    $user &#x3D; UserModel::get(1);
    dump($user-&gt;extend2-&gt;province);
&#125;
&#x2F;&#x2F;D:\wamp64\www\thinkPHP\lesson\thinkphp\library\think\Debug.php:226:string &#39;江西省&#39; (length&#x3D;9)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>也可以通过拓展表的某个属性来查找主表的数据</p>
<p><strong>hasWhere(‘关联模型’,’查找的字段名和数据组成的数组’)</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function test()&#123;
    $user &#x3D; UserModel::hasWhere(&#39;extend2&#39;,[&#39;province&#39;&#x3D;&gt;&#39;江西省&#39;])-&gt;select();
    dump($user);
&#125;
&#x2F;**
* D:\wamp64\www\thinkPHP\lesson\thinkphp\library\think\Debug.php:226:
array (size&#x3D;1)
0 &#x3D;&gt; 
array (size&#x3D;11)
&#39;id&#39; &#x3D;&gt; int 1
&#39;name&#39; &#x3D;&gt; string &#39;张三&#39; (length&#x3D;6)
&#39;phone&#39; &#x3D;&gt; string &#39;13600000000&#39; (length&#x3D;11)
&#39;password&#39; &#x3D;&gt; string &#39;123&#39; (length&#x3D;3)
&#39;gender&#39; &#x3D;&gt; string &#39;女士&#39; (length&#x3D;6)
&#39;birth&#39; &#x3D;&gt; string &#39;2021-05-11&#39; (length&#x3D;10)
&#39;class_id&#39; &#x3D;&gt; int 1
&#39;delete_time&#39; &#x3D;&gt; string &#39;有效&#39; (length&#x3D;6)
&#39;create_time&#39; &#x3D;&gt; null
&#39;update_time&#39; &#x3D;&gt; null
&#39;ip&#39; &#x3D;&gt; null
*&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="一对多关联"><a href="#一对多关联" class="headerlink" title="一对多关联"></a>一对多关联</h4><p>一个班级有多个用户</p>
<p>再为php_user表创建一个php_class表来记录用户的班级</p>
<p>同时在php_user表中创建一个外键class_id并且与php_class的主键id相关联（两个关联字段的类型与大小应该一致）</p>
<p>再为php_class创建一个模型ClassEx（Class为系统关键字，会报错）</p>
<p>此时模型会自动查找php_classex表，会报错，我们应该自己定义此模型对应的数据表，并且在此模型类中写入关联的表</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php
namespace app\common\model;
use think\Model;
class ClassEx extends Model
&#123;
    protected $table &#x3D; &#39;php_class&#39;;
    &#x2F;&#x2F;一个班级有许多用户
    function user()&#123;
        return $this-&gt;hasMany(&#39;User&#39;,&#39;class_id&#39;,&#39;id&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>hasMany(‘关联模型’,’外键’,’主键’);</strong></p>
<p>除了关联模型外，其它参数都是可选。</p>
<ul>
<li><strong>关联模型</strong>（必须）：模型名或者模型类名</li>
<li><strong>外键</strong>：关联模型外键，默认的外键名规则是当前模型名+<code>_id</code></li>
<li><strong>主键</strong>：当前模型主键，一般会自动获取也可以指定传入</li>
</ul>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Controller
function test()&#123;
    $class&#x3D;ClassEx::get(1);
    &#x2F;&#x2F;获取所有两表关联的信息，包括数据库配置一类
    dump($class-&gt;user());
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>若要查询一个班级里面的所有用户</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Controller
function test()&#123;
    &#x2F;&#x2F;传入的id为1，可以查询1891班的同学
    $class&#x3D;ClassExModel::get(1);
    dump($class-&gt;user()-&gt;select());
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>若要查询用户所在的班级</strong></p>
<p>先建立两表关联，即用户属于班级</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;UserModel
function classEx()&#123;
    return $this-&gt;belongsTo(&#39;ClassEx&#39;,&#39;class_id&#39;,&#39;id&#39;);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;Controller
function test()&#123;
    $user &#x3D; UserModel::get(1);
    dump($user-&gt;classEx);
&#x2F;&#x2F;返回id为1的用户在班级表里的信息，返回的信息为数组
&#x2F;*D:\wamp64\www\thinkPHP\lesson\thinkphp\library\think\Debug.php:226:
array (size&#x3D;2)
  &#39;id&#39; &#x3D;&gt; int 1
  &#39;name&#39; &#x3D;&gt; string &#39;1891&#39; (length&#x3D;4)*&#x2F;
    &#x2F;&#x2F;只获取值中name的信息
    dump($user-&gt;classEx[&#39;name&#39;]);
&#x2F;&#x2F;D:\wamp64\www\thinkPHP\lesson\thinkphp\library\think\Debug.php:226:string &#39;1891&#39; (length&#x3D;4)
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="高级知识"><a href="#高级知识" class="headerlink" title="高级知识"></a>高级知识</h2><h3 id="验证器"><a href="#验证器" class="headerlink" title="验证器"></a>验证器</h3><p>使用验证器进行数据校验</p>
<p>可以在admin或common文件夹中创建validate文件夹，在里面创建一个User类</p>
<p>需要继承Validate基类</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;?php

namespace app\common\validate;

use think\Validate;

class User extends Validate
&#123;
    protected $rule &#x3D;   [
        &#39;name&#39;  &#x3D;&gt; &#39;require|max:15|min:6&#39;,
        &#39;phone&#39; &#x3D;&gt; &#39;require|mobile&#39;,
        &#39;birth&#39; &#x3D;&gt; &#39;require&#39;,
        &#39;password&#39; &#x3D;&gt; &#39;require|max:15|min:6&#39;
    ];

    protected $message  &#x3D;   [
        &#39;name.require&#39; &#x3D;&gt; &#39;名称必填&#39;,
        &#39;name.max&#39;     &#x3D;&gt; &#39;名称最多不能超过15个字符&#39;,
        &#39;name.min&#39;     &#x3D;&gt; &#39;名称最少不能少于6个字符&#39;,
        &#39;phone.require&#39; &#x3D;&gt; &#39;手机号必填&#39;,
        &#39;phone.mobile&#39; &#x3D;&gt; &#39;请输入正确的手机号&#39;,
        &#39;birth&#39; &#x3D;&gt; &#39;日期必填&#39;,
        &#39;password.require&#39; &#x3D;&gt; &#39;密码必填&#39;,
        &#39;password.max&#39;     &#x3D;&gt; &#39;密码最多不能超过15个字符&#39;,
        &#39;password.min&#39;     &#x3D;&gt; &#39;密码最少不能少于6个字符&#39;
    ];
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在控制器中使用该验证器</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function save_user()&#123;
    $data&#x3D;input();
    &#x2F;&#x2F;需要先对该验证器进行实例化
    $validate &#x3D; new UserValidate();
    &#x2F;&#x2F;调用check()将数据传入验证，若不符合规则，返回错误信息
    if(!$validate-&gt;check($data))&#123;
        return $this-&gt;error($validate-&gt;getError());
    &#125;
    (new UserService())-&gt;create($data);
    return $this-&gt;success(&#39;添加成功&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="批量验证"><a href="#批量验证" class="headerlink" title="批量验证"></a>批量验证</h4><p>可以一次性显示出所有错误信息</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function save_user()&#123;
    $data&#x3D;input();
    $validate &#x3D; new UserValidate();
    &#x2F;&#x2F;使用batch()进行批量验证
    if(!$validate-&gt;batch()-&gt;check($data))&#123;
        &#x2F;&#x2F;批量验证返回的是一个数组，因此我们需要对错误信息进行遍历、拼接后再输出
        &#x2F;&#x2F;定义一个空数组用于存放错误消息
        $errors &#x3D; &#39;&#39;;
        &#x2F;&#x2F;将返回的错误消息数组遍历
        foreach ($validate-&gt;getError() as $error) &#123;
            &#x2F;&#x2F;拼接错误消息
            $errors .&#x3D; &#39; &#39; . $error;
        &#125;
        &#x2F;&#x2F;输出
        return $this-&gt;error($errors);
    &#125;
    (new UserService())-&gt;create($data);
    return $this-&gt;success(&#39;添加成功&#39;,url(&#39;index&#39;));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>think\facade\Cache类或助手函数cache()可以提供缓存功能的支持</p>
<p>内置支持的缓存类型包括file、memcache、wincache、sqlite、redis和xcache</p>
<p>全局缓存配置可以直接修改配置目录下的cache.php文件</p>
<p>配置参数：</p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">type</td>
<td align="left">缓存类型或者缓存驱动类名</td>
</tr>
<tr>
<td align="left">expire</td>
<td align="left">缓存有效期（秒），默认为0表示永久缓存</td>
</tr>
<tr>
<td align="left">prefix</td>
<td align="left">缓存标识前缀（默认为空）</td>
</tr>
<tr>
<td align="left">serialize</td>
<td align="left">（非标量）是否需要自动序列化</td>
</tr>
</tbody></table>
<p>根据缓存驱动的不同需要配置额外的缓存参数，前三个是通用的缓存参数</p>
<h4 id="cache"><a href="#cache" class="headerlink" title="cache()"></a>cache()</h4><p>我们在开发中比较常用助手函数来设置缓存（类的方式查看文档，了解即可）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function getValidUsers()&#123;
    &#x2F;&#x2F;为用户列表创建缓存
    $cache &#x3D; cache(&#39;users&#39;);
    &#x2F;&#x2F;当缓存不存在
    if (!$cache)&#123;
        &#x2F;&#x2F;因为缓存中存的是一个对象，因此我们需要先将他转成json格式
        $result &#x3D; UserModel::select()-&gt;toJson();
        &#x2F;&#x2F;将查询的结果生成缓存文件，缓存有效期60s
        cache(&#39;users&#39;,$result,60);
        $cache &#x3D; cache(&#39;users&#39;);
    &#125;
    &#x2F;&#x2F;输出缓存数据时需要对其进行解码
    return json_decode($cache);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但由于我们输出的是一个对象，所以我们的视图需要用调用对象属性的方式来渲染数据</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&#123;volist name="users" id="user"&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&#123;$i&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&#123;$user->name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>&#123;$user->phone&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
        &#123;$user->gender&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
        &#123;$user->birth&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
        &#123;$user->delete_time&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>reset_password<span class="token punctuation">'</span>,[<span class="token punctuation">'</span>id<span class="token punctuation">'</span>=>$user->id])&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>重置密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>update_user<span class="token punctuation">'</span>,[<span class="token punctuation">'</span>id<span class="token punctuation">'</span>=>$user->id])&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>delete_user<span class="token punctuation">'</span>,[<span class="token punctuation">'</span>id<span class="token punctuation">'</span>=>$user->id])&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
&#123;/volist&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果我们不想更改视图代码，用**{$user.name}**的方式去调用，我们要在json_decode()加上true参数，将其转换成一个数组</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function getValidUsers()&#123;
    $cache &#x3D; cache(&#39;users&#39;);
    if (!$cache)&#123;
        $result &#x3D; UserModel::select()-&gt;toJson();
        cache(&#39;users&#39;,$result,60);
        $cache &#x3D; cache(&#39;users&#39;);
    &#125;
    return json_decode($cache,true);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在我们进行增删改操作时，需要将缓存清除，将缓存有效时间设置为null</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function create($data)&#123;
    UserModel::create($data);
    cache(&#39;users&#39;,null);
&#125;

function edit($data)&#123;
    UserModel::update($data);
    cache(&#39;users&#39;,null);
&#125;

function sofeDelete($id)&#123;
    $result &#x3D; UserModel::destroy($id);
    cache(&#39;users&#39;,null);
    return $result;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><p>使用paginate()方法可以实现分页（替代select()方法），参数为每页显示多少数据</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function getAllUsers()&#123;
    return UserModel::withTrashed()-&gt;withAttr(&#39;delete_time&#39;,function ($val,$data)&#123;
        return $data[&#39;delete_time&#39;]?&#39;无效用户&#39;:&#39;有效用户&#39;;
    &#125;)-&gt;paginate(4);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>之后在前端代码中可以使用</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#123;$users|raw&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>自动生成一个分页列表，支持使用CSS美化</p>
<h3 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h3><p>首先使用composer在项目根路径下下载拓展库</p>
<pre class="line-numbers language-none"><code class="language-none">composer require topthink&#x2F;think-captcha&#x3D;2.0.*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>之后在模板文件内可以添加验证码的显示代码</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>&#123;:captcha_img()&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!--或--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:captcha_src()&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>captcha<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="验证码配置"><a href="#验证码配置" class="headerlink" title="验证码配置"></a>验证码配置</h4><p>我们可以根据需要，在控制器中对验证码进行设置</p>
<p>相关配置参数查看手册</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function verify()&#123;
    $config &#x3D;    [
        &#x2F;&#x2F; 验证码字体大小
        &#39;fontSize&#39;    &#x3D;&gt;    30,
        &#x2F;&#x2F; 验证码位数
        &#39;length&#39;      &#x3D;&gt;    4,
        &#x2F;&#x2F; 关闭验证码杂点
        &#39;useNoise&#39;    &#x3D;&gt;    false
    ];
    $captcha &#x3D; new Captcha($config);
    return $captcha-&gt;entry();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>login<span class="token punctuation">'</span>)&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>密<span class="token entity named-entity" title="&emsp;">&amp;emsp;</span>码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>验证码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>captcha<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;:url(<span class="token punctuation">'</span>Admin/verify<span class="token punctuation">'</span>)&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>captcha<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">refreshCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="验证码校验"><a href="#验证码校验" class="headerlink" title="验证码校验"></a>验证码校验</h4><p>之后再在login的控制器方法里对验证码进行校验</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function login()&#123;
    &#x2F;&#x2F;能支持用户名|手机号与密码登录
    $name &#x3D; input(&#39;name&#39;);
    $password &#x3D; input(&#39;password&#39;);
    &#x2F;&#x2F;验证器
    $validate &#x3D; new UserLoginValidate();
    if (!$validate-&gt;batch()-&gt;check(input()))&#123;
        $errors&#x3D;&#39;&#39;;
        foreach ($validate-&gt;getError() as $error)&#123;
            $errors .&#x3D;&quot; &quot;.$error;
        &#125;
        return $this-&gt;error($errors);
    &#125;
    &#x2F;&#x2F;获取输入的验证码
    $captcha &#x3D; input(&#39;code&#39;);
    &#x2F;&#x2F;对验证码进行校验
    if (!captcha_check($captcha))&#123;
        return $this-&gt;error(&#39;验证码不正确&#39;);
    &#125;
    $result &#x3D; (new UserService())-&gt;login($name,$password);
    if ($result)&#123;
        $this-&gt;success(&#39;登录成功&#39;,&#39;index&#39;);
    &#125;else&#123;
        $this-&gt;error(&#39;用户名或密码错误，请重新输入&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意：生成的验证码需要保存在session作用域内，因此需要将配置文件session.php内的auto_start设置为true。</p>
<h4 id="验证码刷新"><a href="#验证码刷新" class="headerlink" title="验证码刷新"></a>验证码刷新</h4><p>可以通过JavaScript来设置点击图片刷新验证码的功能</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
	<span class="token keyword">function</span> <span class="token function">refreshCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> captcha <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'captcha'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    captcha<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"&#123;:url('Admin/verify')&#125;"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="登录校验"><a href="#登录校验" class="headerlink" title="登录校验"></a>登录校验</h3><p>我们可以在登录成功后，将当前的用户信息记录到session作用域中。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;UserService
function login($account,$password)&#123;
    $result &#x3D; UserModel::where(&#39;name|phone&#39;,$account)
        -&gt;where(&#39;password&#39;,$password)
        -&gt;find();
    if($result)&#123;
        session(&#39;user&#39;,$account);
    &#125;
    return $result!&#x3D;null;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以在前端模板上显示当前登录的用户信息</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&lt;span&gt;当前用户为：&#123;$Think.session.user&#125;&lt;&#x2F;span&gt;
&lt;a href&#x3D;&quot;&#123;:url(&#39;tologin&#39;)&#125;&quot;&gt;注销&lt;&#x2F;a&gt;&lt;br&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这时在注销时就应该清空session内的user信息</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function toLogin()&#123;
    session(&#39;user&#39;,null);
    return $this-&gt;fetch(&#39;login&#39;);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>在还未登录时，用户应该无法访问除了登录页外的所有页面（类似JavaEE的过滤器）</p>
<p>我们可以在控制器中加入方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">function checkLogin()&#123;
    &#x2F;&#x2F;当session内没有user的信息时返回错误信息并且跳转到toLogin
    if (!session(&#39;user&#39;))&#123;
        return $this-&gt;error(&#39;请先登录&#39;,&#39;toLogin&#39;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>之后就可以在其他的页面中调用此方法来完成过滤</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">public function index()&#123;
    $this-&gt;checkLogin();
    $result &#x3D; (new UserService())-&gt;getAllUsers();
    return $this-&gt;fetch(&#39;&#39;,[&#39;users&#39;&#x3D;&gt;$result,&#39;footer&#39;&#x3D;&gt;&#39;吴炜瀚&#39;]);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但是每个新的页面都要调用一次登录校验的方法太过麻烦，我们可以使用控制器的前置操作来实现一个统一的检查</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">protected $beforeActionList &#x3D; [
    &#39;checkLogin&#39; &#x3D;&gt; [&#39;except&#39; &#x3D;&gt; &#39;toLogin,login,verify&#39;]
];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>注意：需要用except排除不需要检查的操作，或者用only来指定需要检查的操作</p>
<h3 id="图像处理"><a href="#图像处理" class="headerlink" title="图像处理"></a>图像处理</h3><p>首先使用composer在项目根路径下下载拓展库</p>
<pre class="line-numbers language-none"><code class="language-none">composer require topthink&#x2F;think-image<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们可以在static文件夹下面创建img文件夹用来存放待操作的图片</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F;绝对路径
$root_path &#x3D; $_SERVER[&#39;DOCUMENT_ROOT&#39;];
$img_path &#x3D; $root_path . &#39;&#x2F;static&#x2F;img&#x2F;img.png&#39;;
&#x2F;&#x2F;相对路径：&quot;.&#x2F;static&#x2F;img&#x2F;img.png&quot;
$img &#x3D; Image::open($img_path);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>文件的路径从public开始写即可</p>
<h4 id="剪裁图片"><a href="#剪裁图片" class="headerlink" title="剪裁图片"></a>剪裁图片</h4><p>前两个参数表示剪裁的大小，后两个参数表示剪裁开始的坐标</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">$img-&gt;crop(300,300,100,100)-&gt;save(&#39;.&#x2F;static&#x2F;crop_img&#x2F;imgage_crop2.png&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="生成缩略图"><a href="#生成缩略图" class="headerlink" title="生成缩略图"></a>生成缩略图</h4><p>前两参数表示缩放的比例，第三个参数表示缩放的类型</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">$img-&gt;thumb(150,150,Image::THUMB_CENTER)-&gt;save(&#39;.&#x2F;static&#x2F;thumb_img&#x2F;img_thumb2.png&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="添加水印"><a href="#添加水印" class="headerlink" title="添加水印"></a>添加水印</h4><p>第一个参数表示要加上的水印图片，可以添加第二个参数表示要以什么方式添加水印</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">$img-&gt;water(&#39;.&#x2F;static&#x2F;thumb_img&#x2F;img_thumb2.png&#39;)-&gt;save(&#39;.&#x2F;static&#x2F;water_img&#x2F;img_water.png&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="调试和命令行"><a href="#调试和命令行" class="headerlink" title="调试和命令行"></a>调试和命令行</h3><h4 id="调试模式-1"><a href="#调试模式-1" class="headerlink" title="调试模式"></a>调试模式</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 开启调试模式——app.php配置文件
&#39;app_debug&#39; &#x3D;&gt; true,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>开启调试模式后会牺牲一定的执行效率，但能为解决bug带来方便</p>
<p>优势：</p>
<ul>
<li>开启日志记录，任何错误信息和调试信息都会详细记录，便于调试；</li>
<li>会详细记录整个执行过程；</li>
<li>模板修改可以即时生效；</li>
<li>记录SQL日志，方便分析SQL；</li>
<li>通过Trace功能更好的调试和发现错误；</li>
<li>发生异常的时候会显示详细的异常信息；</li>
</ul>
<h4 id="Trace调试"><a href="#Trace调试" class="headerlink" title="Trace调试"></a>Trace调试</h4><p>给开发人员提供一个用于开发调试的辅助工具，可以实时查看当前页面或者请求的请求信息、运行情况、SQL执行、错误信息和调试信息等，同时支持自己在trace.php配置文件下自定义trace工具</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">&#x2F;&#x2F; 开启应用Trace调试
&#39;app_trace&#39; &#x3D;&gt;  true,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="变量调试"><a href="#变量调试" class="headerlink" title="变量调试"></a>变量调试</h4><p>dump()</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">$blog &#x3D; Db::name(&#39;blog&#39;)-&gt;where(&#39;id&#39;, 3)-&gt;find();
dump($blog);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>使用halt()函数可以在调试变量输出后中止接下来代码的执行</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">$blog &#x3D; Db::name(&#39;blog&#39;)-&gt;where(&#39;id&#39;, 3)-&gt;find();
halt($blog);
echo &#39;这里的信息是看不到的&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="内置服务器"><a href="#内置服务器" class="headerlink" title="内置服务器"></a>内置服务器</h4><p>启动内置服务器:php think run（少用）</p>
<h4 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h4><p>php think version</p>
<h4 id="自动生成模块"><a href="#自动生成模块" class="headerlink" title="自动生成模块"></a>自动生成模块</h4><p>php think build –module test</p>
<p>会自动生成模块，模块内文件包括</p>
<p>test</p>
<ul>
<li>config</li>
<li>controller<ul>
<li>index.php</li>
</ul>
</li>
<li>model</li>
<li>view</li>
<li>common.php</li>
</ul>
<h4 id="自动生成类文件"><a href="#自动生成类文件" class="headerlink" title="自动生成类文件"></a>自动生成类文件</h4><p>主要有四种：Controller类，Service类，Model类，Validate类</p>
<p><strong>生成一个资源控制器</strong></p>
<p>php think make:controller index/Blog</p>
<p>如果要<strong>生成空的控制器</strong>可以</p>
<p>php think make:controller index/Blog –plain</p>
<p><strong>生成模型</strong></p>
<p>php think make:model index/Blog</p>
<h4 id="清空缓存文件"><a href="#清空缓存文件" class="headerlink" title="清空缓存文件"></a>清空缓存文件</h4><p>php think clear</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Weihan Wu</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2022/05/16/thinkphp/">http://example.com/2022/05/16/thinkphp/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Weihan Wu</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                                    <span class="chip bg-color">学习笔记</span>
                                </a>
                            
                                <a href="/tags/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">
                                    <span class="chip bg-color">框架学习</span>
                                </a>
                            
                                <a href="/tags/PHP/">
                                    <span class="chip bg-color">PHP</span>
                                </a>
                            
                                <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">
                                    <span class="chip bg-color">后端开发</span>
                                </a>
                            
                                <a href="/tags/Think-PHP/">
                                    <span class="chip bg-color">Think PHP</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2022/05/16/thinkphp/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/22.jpg" class="responsive-img" alt="Think PHP5.1">
                        
                        <span class="card-title">Think PHP5.1</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            ThinkPHP是一个免费开源的，快速、简单的面向对象的轻量级PHP开发框架，是为了敏捷WEB应用开发和简化企业应用开发而诞生的。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-05-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/PHP/" class="post-category">
                                    PHP
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">学习笔记</span>
                    </a>
                    
                    <a href="/tags/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">
                        <span class="chip bg-color">框架学习</span>
                    </a>
                    
                    <a href="/tags/PHP/">
                        <span class="chip bg-color">PHP</span>
                    </a>
                    
                    <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">
                        <span class="chip bg-color">后端开发</span>
                    </a>
                    
                    <a href="/tags/Think-PHP/">
                        <span class="chip bg-color">Think PHP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/05/16/php/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="PHP基础">
                        
                        <span class="card-title">PHP基础</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            PHP基础语法。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-05-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/PHP/" class="post-category">
                                    PHP
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">学习笔记</span>
                    </a>
                    
                    <a href="/tags/PHP/">
                        <span class="chip bg-color">PHP</span>
                    </a>
                    
                    <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">
                        <span class="chip bg-color">后端开发</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022</span>
            
            <span id="year">2022</span>
            <a href="/about" target="_blank">Weihan Wu</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">165.3k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/weihan-wu" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:904698202@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=904698202" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 904698202" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
